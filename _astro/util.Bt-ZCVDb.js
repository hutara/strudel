const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["_astro/index.VCcaijur.js","_astro/index.D1tCthlq.js","_astro/spectrum.3xUQRZ8h.js","_astro/index.DmSyaW3g.js","_astro/browser.DeD4NJl7.js","_astro/_commonjsHelpers.BosuxZz1.js","_astro/index.hZxiVsR6.js","_astro/index.CqHAoRZ_.js","_astro/codemirror.Cfeuy1TC.js","_astro/index.BB2Lnacl.js","_astro/hydra.gpAyA9If.js","_astro/serial.CFhbqbTc.js","_astro/index.B1eFgcIO.js","_astro/preload-helper.CLcXU_4U.js","_astro/tidal.DeIgCVsn.js","_astro/index.DTgqVnXz.js","_astro/index.C9AzqDct.js","_astro/mqtt.lCJglmVd.js","_astro/mondough.BrbK85b5.js","_astro/loggerbridge.B2zeuyNh.js","_astro/index.B9mnsnPE.js","_astro/midibridge.Kbn8ImPn.js","_astro/utils.xCB6EdHR.js","_astro/oscbridge.CiWy4BsD.js","_astro/osc.BQLdUe1R.js","_astro/index.C4_94hhA.js"])))=>i.map(i=>d[i]);
import{A as Js,B as Hs,C as Ws,D as Gs,E as Ks,F as Qs,G as Ys,x as Xs,H as Zs,I as en,J as tn,K as sn,L as nn,M as rn,z as an,c as on,N as cn,S as ln,O as un,P as dn,Q as hn,R as fn,T as pn,U as gn,V as _n,W as mn,X as wn,Y as yn,Z as bn,_ as vn,$ as kn,a0 as Sn,a1 as En,a2 as Tn,a3 as Pn,a4 as An,a5 as On,a6 as jn,a7 as Rn,a8 as $n,y as Cn,a9 as xn,aa as In,ab as Ln,ac as Dn,i as Un,ad as Bn,ae as Mn,af as Nn,ag as Fn,ah as qn,ai as zn,aj as Vn}from"./codemirror.Cfeuy1TC.js";import{r as q,a as ae,o as I,b as oe,g as D,p as ce,q as yt,t as De,d as Ne,c as Fe,u as qe,v as Ue,x as ve,y as Qt,z as Yt,h as Be,A as Jn,B as bt,C as Hn,E as Wn,F as Xt,G as Zt,H as es,I as ts,J as ss,K as J,L as ns,M as rs,w as Gn,N as Kn,O as Qn,P as Yn,Q as Xn,D as Zn,s as er,f as tr,R as sr,S as nr,T as rr,U as ir,e as ar,V as or,l as cr,W as lr,X as ur,Y as dr,Z as hr,n as fr,_ as pr,$ as gr,i as _r,j as mr,a0 as wr,a1 as yr,a2 as br,a3 as vr,m as kr,a4 as Sr,a5 as Er,a6 as Tr,a7 as Pr,a8 as Ar,a9 as Or,aa as jr,ab as Rr,ac as $r,ad as Cr,ae as xr,af as Ir,ag as Lr,ah as Dr,ai as Ur,aj as Br,ak as Mr,al as Nr,am as Fr,an as qr,ao as zr,ap as Vr,aq as Jr,k as Hr,ar as Wr,as as Gr,at as Kr,au as Qr}from"./spectrum.3xUQRZ8h.js";import{_ as E}from"./preload-helper.CLcXU_4U.js";import{l as U,n as is,P as as,a0 as os,c as Yr,a1 as Xr,a2 as Zr}from"./index.D1tCthlq.js";import{r as We}from"./index.B9mnsnPE.js";/* empty css                      */import{a as ei,g as ti}from"./_commonjsHelpers.BosuxZz1.js";import{q as cs}from"./index.DmSyaW3g.js";const si=Object.freeze(Object.defineProperty({__proto__:null,StartRules:sn,SyntaxError:nn,getLeafLocation:Ws,getLeafLocations:Qs,getLeaves:Ks,h:Zs,m:Xs,mini:Ys,mini2ast:Gs,miniAllStrings:tn,minify:en,parse:rn,patternifyAST:Hs},Symbol.toStringTag,{value:"Module"}));function ni(n,e,t){let s=new Set([...e,void 0]);return n.listen((r,i,a)=>{s.has(a)&&t(r,i,a)})}const ri=["triangle","square","sawtooth","sine"],ii=[["tri","triangle"],["sqr","square"],["saw","sawtooth"],["sin","sine"]];function ai(n,e){const t=n,s=new Float32Array(e);for(let r=0;r<e;r++){const i=r*2/e-1;s[r]=Math.tanh(i*t)}return s}function ls(){[...ri].forEach(n=>{q(n,(e,t,s)=>{const[r,i,a,o]=ae([t.attack,t.decay,t.sustain,t.release],"linear",[.001,.05,.6,.01]);let c=ds(n,e,t),{node:l,stop:u,triggerRelease:d}=c;const h=I(.3),{duration:f}=t;l.onended=()=>{l.disconnect(),h.disconnect(),s()};const p=I(1);let _=l.connect(h).connect(p);const g=e+f;oe(_.gain,r,i,a,o,0,1,e,g,"linear");const y=g+o+.01;return d?.(y),u(y),{node:_,stop:m=>{u(m)}}},{type:"synth",prebake:!0})}),q("sbd",(n,e,t)=>{const{duration:s,decay:r=.5,pdecay:i=.5,penv:a=36,clip:o}=e,c=D(),l=.02,u=1.2,d=.025,h=1,f=c.createOscillator();f.type="triangle",f.frequency.value=ce(e,29),f.detune.setValueAtTime(a*100,0),f.detune.setValueAtTime(a*100,n),f.detune.exponentialRampToValueAtTime(.001,n+i);const p=I(1);p.gain.setValueAtTime(1,n+l),p.gain.exponentialRampToValueAtTime(.001,n+l+r),f.start(n);const _=yt("brown",n,2),g=I(1);g.gain.setValueAtTime(u,n),g.gain.exponentialRampToValueAtTime(.001,n+d);const y=new WaveShaperNode(c);y.curve=ai(2,c.sampleRate);const m=I(h);f.onended=()=>{f.disconnect(),p.disconnect(),y.disconnect(),_.node.disconnect(),g.disconnect(),m.disconnect(),t()};const S=f.connect(y).connect(p).connect(m);_.node.connect(g).connect(m);let w=n+r+.01;return o!=null&&(w=Math.min(n+o*s,w)),m.gain.setValueAtTime(h,w-.01),m.gain.linearRampToValueAtTime(0,w),f.stop(w),_.stop(w),{node:S,stop:x=>{f.stop(x)}}},{type:"synth",prebake:!0}),q("supersaw",(n,e,t)=>{const s=D();let{duration:r,n:i,unison:a=5,spread:o=.6,detune:c}=e;c=c??i??.18;const l=ce(e),[u,d,h,f]=ae([e.attack,e.decay,e.sustain,e.release],"linear",[.001,.05,.6,.01]),p=n+r,_=p+f+.01,g=bt(a,1,100);let y=g>1?bt(o,0,1):0,m=De(s,"supersaw-oscillator",{frequency:l,begin:n,end:_,freqspread:c,voices:g,panspread:y},{outputChannelCount:[2]});const S=1/Math.sqrt(g);Ne(m.parameters.get("detune"),e,n,p);const k=Fe(m.parameters.get("detune"),e,n),w=qe(m.parameters.get("frequency"),e,n);let x=I(1);x=m.connect(x),oe(x.gain,u,d,h,f,0,.3*S,n,p,"linear");let he=Ue(s,()=>{ve(m),x.disconnect(),t(),w?.stop(),k?.stop()},n,_);return{node:x,stop:te=>{he.stop(te)}}},{prebake:!0,type:"synth"}),q("bytebeat",(n,e,t)=>{const s=["(t%255 >= t/255%255)*255","(t*(t*8%60 <= 300)|(-t)*(t*4%512 < 256))+t/400","t","t*(t >> 10^t)","t&128","t&t>>8","((t%255+t%128+t%64+t%32+t%16+t%127.8+t%64.8+t%32.8+t%16.8)/3)","((t%64+t%63.8+t%64.15+t%64.35+t%63.5)/1.25)","(t&(t>>7)-t)","(sin(t*PI/128)*127+127)","((t^t/2+t+64*(sin((t*PI/64)+(t*PI/32768))+64))%128*2)","((t^t/2+t+64*(cos >> 0))%127.85*2)","((t^t/2+t+64)%128*2)","(((t * .25)^(t * .25)/100+(t * .25))%128)*2","((t^t/2+t+64)%7 * 24)"],{n:r=0}=e,i=ce(e),{byteBeatExpression:a=s[r%s.length],byteBeatStartTime:o}=e,c=D();let{duration:l}=e;const[u,d,h,f]=ae([e.attack,e.decay,e.sustain,e.release],"linear",[.001,.05,.6,.01]),p=n+l,_=p+f+.01;let g=De(c,"byte-beat-processor",{frequency:i,begin:n,end:_},{outputChannelCount:[2]});g.port.postMessage({codeText:a,byteBeatStartTime:o,frequency:i});let y=I(1);y=g.connect(y),oe(y.gain,u,d,h,f,0,1,n,p,"linear");let m=Ue(c,()=>{ve(g),y.disconnect(),t()},n,_);return{node:y,stop:S=>{m.stop(S)}}},{prebake:!0,type:"synth"}),q("pulse",(n,e,t)=>{const s=D();let{pwrate:r,pwsweep:i}=e;i==null&&(r!=null?i=.3:i=0),r==null&&i!=null&&(r=1);let{duration:a,pw:o=.5}=e;const c=ce(e),[l,u,d,h]=ae([e.attack,e.decay,e.sustain,e.release],"linear",[.001,.05,.6,.01]),f=n+a,p=f+h+.01;let _=De(s,"pulse-oscillator",{frequency:c,begin:n,end:p,pulsewidth:o},{outputChannelCount:[2]});Ne(_.parameters.get("detune"),e,n,f);const g=Fe(_.parameters.get("detune"),e,n),y=qe(_.parameters.get("frequency"),e,n);let m=I(1);m=_.connect(m),oe(m.gain,l,u,d,h,0,1,n,f,"linear");let S;i!=0&&(S=Qt(s,n,p,{frequency:r,depth:i}),S.connect(_.parameters.get("pulsewidth")));let k=Ue(s,()=>{ve(_),ve(S),m.disconnect(),t(),y?.stop(),g?.stop()},n,p);return{node:m,stop:w=>{k.stop(w)}}},{prebake:!0,type:"synth"}),[...Yt].forEach(n=>{q(n,(e,t,s)=>{const[r,i,a,o]=ae([t.attack,t.decay,t.sustain,t.release],"linear",[.001,.05,.6,.01]);let c,{density:l}=t;c=yt(n,e,l);let{node:u,stop:d,triggerRelease:h}=c;const f=I(.3),{duration:p}=t;u.onended=()=>{u.disconnect(),f.disconnect(),s()};const _=I(1);let g=u.connect(f).connect(_);const y=e+p;oe(g.gain,r,i,a,o,0,1,e,y,"linear");const m=y+o+.01;return h?.(m),d(m),{node:g,stop:S=>{d(S)}}},{type:"synth",prebake:!0})}),ii.forEach(([n,e])=>Be.set({...Be.get(),[n]:Be.get()[e]}))}function us(n,e){const t=new Float32Array(n+1),s=new Float32Array(n+1),r=D(),i=r.createOscillator(),a={sawtooth:l=>[0,-1/l],square:l=>[0,l%2===0?0:1/l],triangle:l=>[l%2===0?0:1/(l*l),0]};if(!a[e])throw new Error(`unknown wave type ${e}`);t[0]=0,s[0]=0;let o=1;for(;o<=n;){const[l,u]=a[e](o);t[o]=l,s[o]=u,o++}const c=r.createPeriodicWave(t,s);return i.setPeriodicWave(c),i}function ds(n,e,t){let{n:s,duration:r,noise:i=0}=t,a;!s||n==="sine"?(a=D().createOscillator(),a.type=n||"triangle"):a=us(s,n),a.frequency.value=ce(t),a.start(e);let o=Fe(a.detune,t,e);Ne(a.detune,t,e,e+r);const c=qe(a.frequency,t,e);let l;return i&&(l=Jn(a,i,e)),{node:l?.node||a,stop:u=>{c.stop(u),o?.stop(u),l?.stop(u),a.stop(u)},triggerRelease:u=>{}}}function oi(n=1,e=.05,t=220,s=0,r=0,i=.1,a=0,o=1,c=0,l=0,u=0,d=0,h=0,f=0,p=0,_=0,g=0,y=1,m=0,S=0){let k=Math.PI*2,w=D().sampleRate,x=Vs=>Vs>0?1:-1,he=c*=500*k/w/w,te=t*=(1+e*2*Math.random()-e)*k/w,Oe=[],B=0,je=0,P=0,z=1,qs=0,zs=0,V=0,He,se;for(s=s*w+9,m*=w,r*=w,i*=w,g*=w,l*=500*k/w**3,p*=k/w,u*=k/w,d*=w,h=h*w|0,se=s+m+r+i+g|0;P<se;Oe[P++]=V)++zs%(_*100|0)||(V=a?a>1?a>2?a>3?Math.sin((B%k)**3):Math.max(Math.min(Math.tan(B),1),-1):1-(2*B/k%2+2)%2:1-4*Math.abs(Math.round(B/k)-B/k):Math.sin(B),V=(h?1-S+S*Math.sin(k*P/h):1)*x(V)*Math.abs(V)**o*n*1*(P<s?P/s:P<s+m?1-(P-s)/m*(1-y):P<s+m+r?y:P<se-g?(se-P-g)/i*y:0),V=g?V/2+(g>P?0:(P<se-g?1:(se-P)/g)*Oe[P-g|0]/2):V),He=(t+=c+=l)*Math.cos(p*je++),B+=He-He*f*(1-(Math.sin(P)+1)*1e9%2),z&&++z>d&&(t+=u,te+=u,z=0),h&&!(++qs%h)&&(t=te,c=he,z||=1);return Oe}const hs=(n,e)=>{let{s:t,note:s=36,freq:r,zrand:i=0,attack:a=0,decay:o=0,sustain:c=.8,release:l=.1,curve:u=1,slide:d=0,deltaSlide:h=0,pitchJump:f=0,pitchJumpTime:p=0,lfo:_=0,znoise:g=0,zmod:y=0,zcrush:m=0,zdelay:S=0,tremolo:k=0,duration:w=.2,zzfx:x}=n;const he=Math.max(w-a-o,0);typeof s=="string"&&(s=Hn(s)),!r&&typeof s=="number"&&(r=Wn(s)),t=t.replace("z_","");const te=["sine","triangle","sawtooth","tan","noise"].indexOf(t)||0;u=t==="square"?0:u;const B=oi(...x||[.25,i,r,a,he,l,te,u,d,h,f,p,_,g,y,m,S,c,o,k]),je=D(),P=je.createBuffer(1,B.length,je.sampleRate);P.getChannelData(0).set(B);const z=D().createBufferSource();return z.buffer=P,z.start(e),{node:z}};function fs(){["zzfx","z_sine","z_sawtooth","z_triangle","z_square","z_tan","z_noise"].forEach(n=>{q(n,(e,t,s)=>{const{node:r}=hs({s:n,...t},e);return r.onended=()=>{r.disconnect(),s()},{node:r,stop:()=>{}}},{type:"synth",prebake:!0})})}const ci=Object.freeze(Object.defineProperty({__proto__:null,DEFAULT_MAX_POLYPHONY:Zn,Warpmode:Wr,aliasBank:ns,get analysers(){return wr},get analysersData(){return yr},applyFM:qe,applyGainCurve:sr,applyParameterModulators:xr,connectToDestination:mr,createFilter:Ir,destroyAudioWorkletNode:ve,distortionAlgorithms:Dr,dough:zr,doughTrigger:Vr,doughsamples:Xn,drawFrequencyScope:Yn,drawTimeScope:Qn,drywet:Lr,dspWorklet:qr,effectSend:$r,errorLogger:Mr,gainNode:I,getADSRValues:ae,getAnalyserById:br,getAnalyzerData:vr,getAudioContext:D,getAudioContextCurrentTime:Hr,getAudioDevices:ar,getCachedBuffer:Tr,getCompressor:Cr,getDefaultValue:ur,getDistortion:Br,getDistortionAlgorithm:Ur,getFrequencyFromValue:ce,getLfo:Qt,getLoadedBuffer:Rr,getOscillator:ds,getParamADSR:oe,getPitchEnvelope:Ne,getSampleBuffer:Ar,getSampleBufferSource:Or,getSampleInfo:Pr,getSound:ir,getVibratoOscillator:Fe,getWorklet:De,getZZFX:hs,initAudio:gr,initAudioOnFirstClick:_r,loadBuffer:ts,logger:Nr,noises:Yt,onTriggerSample:es,onTriggerSynth:Qr,processSampleMap:Zt,registerSampleSource:ss,registerSamplesPrefix:Xt,registerSound:q,registerSynthSounds:ls,registerWaveTable:Gr,registerWorklet:pr,registerZZFXSounds:fs,resetDefaultValues:hr,resetDefaults:cr,resetGlobalEffects:kr,resetLoadedSounds:fr,reverseBuffer:jr,samples:J,setDefault:or,setDefaultAudioContext:Jr,setDefaultValue:lr,setDefaultValues:dr,setGainCurve:nr,setLogger:Fr,setMaxPolyphony:er,setMultiChannelOrbits:tr,setVersionDefaults:rs,soundAlias:rr,soundMap:Be,superdough:Sr,superdoughTrigger:Er,tables:Kr,waveformN:us,webAudioTimeout:Ue,webaudioOutput:Gn,webaudioRepl:Kn},Symbol.toStringTag,{value:"Module"})),li=Object.freeze(Object.defineProperty({__proto__:null,BlockWidget:qn,SliderWidget:Pn,StrudelMirror:ln,activateTheme:Bn,addWidget:Mn,codemirrorSettings:on,defaultSettings:an,flash:Sn,flashField:kn,highlightExtension:yn,highlightMiniLocations:wn,initEditor:cn,initTheme:Un,injectStyle:Dn,isFlashEnabled:En,isPatternHighlightingEnabled:bn,markcss:un,registerWidget:Vn,setFlash:vn,setMiniLocations:gn,setSliderWidgets:An,setWidget:Fn,settings:xn,showMiniLocations:_n,slider:Rn,sliderPlugin:jn,sliderValues:Tn,sliderWithID:$n,theme:Ln,themeColors:In,themes:Cn,toggleBlockComment:dn,toggleBlockCommentByLine:hn,toggleComment:fn,toggleLineComment:pn,updateMiniLocations:mn,updateSliderWidgets:On,updateWidgets:Nn,widgetPlugin:zn},Symbol.toStringTag,{value:"Module"}));let ps;typeof window<"u"&&(ps=window?.__TAURI__);const{BaseDirectory:ui,readDir:di,readBinaryFile:hi,writeTextFile:fi,readTextFile:pi,exists:gi}=ps?.fs||{},Te=ui?.Audio,vt="~/music/";async function _i(n){return gi(n+"/strudel.json",{dir:Te})}async function mi(n){const e=await pi(n+"/strudel.json",{dir:Te}),t=JSON.parse(e);Zt(t,(s,r)=>{q(s,(i,a,o)=>es(i,a,o,r,bi(n)),{type:"sample",samples:r,fileSystem:!0,tag:"local"})})}async function wi(n){const e=await di(n,{dir:Te,recursive:!0}),s={name:n.split("/").slice(-1)[0],children:e};let r={},i=0;gs(s,(c,l)=>{["wav","mp3"].includes(c.name.split(".").slice(-1)[0])&&(r[l.name]=r[l.name]||[],i+=1,r[l.name].push(c.subpath.slice(1).concat([c.name]).join("/")))});const a=JSON.stringify(r,null,2),o=n+"/strudel.json";await fi(o,a,{dir:Te}),console.log(`wrote strudel.json with ${i} samples to ${n}!`)}Xt(vt,async n=>{const e=n.replace(vt,"");return await _i(e)||await wi(e),mi(e)});const gs=(n,e)=>{if(Array.isArray(n?.children))for(const t of n.children)t.subpath=(n.subpath||[]).concat([n.name]),e(t,n),t.children&&gs(t,e)},_s=n=>["wav","mp3","flac","ogg","m4a","aac"].includes(n.split(".").slice(-1)[0]);function yi(n){const e=new Blob([n],{type:"audio/*"});return URL.createObjectURL(e)}const Re={};async function ms(n){return Re[n]||(Re[n]=(async()=>{const e=await hi(n,{dir:Te});return yi(e)})()),Re[n]}const bi=n=>e=>ms(n.endsWith("/")?n+e:n+"/"+e);async function Xo(n){const e=await ms(n),t=D(),s=t.createBufferSource();s.buffer=await ts(e,t),s.connect(t.destination),s.start(t.currentTime)}const vi={dbName:"samples",table:"usersamples",columns:["blob","title"],version:1};function Zo(n){return window.indexedDB.deleteDatabase(n)}function ki(n=vi,e=()=>{}){ws(n,t=>{const s=t.getAll();s.onerror=r=>{U("User Samples failed to load ","error"),e(),console.error(r?.target?.error)},s.onsuccess=r=>{const i=r.target.result;if(!i?.length)return;const a=new Map;Promise.all([...i].sort((o,c)=>o.title.localeCompare(c.title,void 0,{numeric:!0,sensitivity:"base"})).map((o,c)=>{const l=o.title;if(!_s(l))return;const u=o.id.split("/");let d=u[u.length-2]??o.id.split(/\W+/)[0]??"user";const h=o.blob;return Si(h).then(f=>{const p=a.get(d)??new Map;p.set(l,f),a.set(d,p)})})).then(()=>{a.forEach((o,c)=>{const l=Array.from(o.keys()).sort((u,d)=>u.localeCompare(d)).map(u=>o.get(u));ss(c,l,{prebake:!1})}),U("imported sounds registered!","success"),e()}).catch(o=>{U("Something went wrong while registering saved samples from the index db","error"),console.error(o)})}})}async function Si(n){return new Promise(e=>{e(URL.createObjectURL(n))})}function ws(n,e){const{dbName:t,version:s,table:r,columns:i}=n;if(typeof window>"u")return;if(!("indexedDB"in window)){console.log("IndexedDB is not supported.");return}const a=indexedDB.open(t,s);return a.onupgradeneeded=o=>{const l=a.result.createObjectStore(r,{keyPath:"id",autoIncrement:!1});i.forEach(u=>{l.createIndex(u,u,{unique:!1})})},a.onerror=o=>{U("Something went wrong while trying to open the the client DB","error"),console.error(`indexedDB error: ${o.errorCode}`)},a.onsuccess=()=>{const o=a.result,l=o.transaction([r],"readwrite").objectStore(r);e(l,o)},a}async function Ei(n){return Promise.all(Array.from(n).map(e=>{const t=e.name;if(!_s(t))return;const s=URL.createObjectURL(e);return fetch(s).then(r=>r.blob().then(i=>{const a=e.webkitRelativePath;let o=a?.length?a:t;if(!(o==null||t==null||i==null))return{title:t,blob:i,id:o}}))}).filter(Boolean)).catch(e=>{U("Something went wrong while processing uploaded files","error"),console.error(e)})}async function ec(n,e){U("procesing user samples..."),await Ei(e).then(t=>{U("user samples processed... opening db"),ws(n,(r,i)=>{U("index db opened... writing files to db"),t.forEach(a=>{a!=null&&r.put(a)}),U("user samples written successfully")})})}const Ti=is("C8"),Pi=(n,e)=>n*e+(1-e)/2;as.prototype.piano=function(){return this.clip(1).s("piano").release(.1).fmap(n=>{const e=os(n),t=Pi(Math.min(Math.round(e)/Ti,1),.5);return{...n,pan:(n.pan||1)*t}})};const Ai={ASSETS_PREFIX:void 0,BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SITE:"https://hutara.github.io/strudel/",SSR:!1},{BASE_URL:Ge}=Ai;Ge.endsWith("/")&&Ge.slice(0,-1);const R="https://strudel.cc";async function tc(){await Promise.all([ls(),fs(),ki(),E(async()=>{const{registerSoundfonts:n}=await import("./index.VCcaijur.js");return{registerSoundfonts:n}},__vite__mapDeps([0,1,2,3])).then(({registerSoundfonts:n})=>n()),J(`${R}/piano.json`,`${R}/piano/`,{prebake:!0}),J(`${R}/vcsl.json`,`${R}/VCSL/`,{prebake:!0}),J(`${R}/tidal-drum-machines.json`,`${R}/tidal-drum-machines/machines/`,{prebake:!0,tag:"drum-machines"}),J(`${R}/uzu-drumkit.json`,`${R}/uzu-drumkit/`,{prebake:!0,tag:"drum-machines"}),J(`${R}/uzu-wavetables.json`,`${R}/uzu-wavetables/`,{prebake:!0}),J(`${R}/mridangam.json`,`${R}/mrid/`,{prebake:!0,tag:"drum-machines"}),J({casio:["casio/high.wav","casio/low.wav","casio/noise.wav"],crow:["crow/000_crow.wav","crow/001_crow2.wav","crow/002_crow3.wav","crow/003_crow4.wav"],insect:["insect/000_everglades_conehead.wav","insect/001_robust_shieldback.wav","insect/002_seashore_meadow_katydid.wav"],wind:["wind/000_wind1.wav","wind/001_wind10.wav","wind/002_wind2.wav","wind/003_wind3.wav","wind/004_wind4.wav","wind/005_wind5.wav","wind/006_wind6.wav","wind/007_wind7.wav","wind/008_wind8.wav","wind/009_wind9.wav"],jazz:["jazz/000_BD.wav","jazz/001_CB.wav","jazz/002_FX.wav","jazz/003_HH.wav","jazz/004_OH.wav","jazz/005_P1.wav","jazz/006_P2.wav","jazz/007_SN.wav"],metal:["metal/000_0.wav","metal/001_1.wav","metal/002_2.wav","metal/003_3.wav","metal/004_4.wav","metal/005_5.wav","metal/006_6.wav","metal/007_7.wav","metal/008_8.wav","metal/009_9.wav"],east:["east/000_nipon_wood_block.wav","east/001_ohkawa_mute.wav","east/002_ohkawa_open.wav","east/003_shime_hi.wav","east/004_shime_hi_2.wav","east/005_shime_mute.wav","east/006_taiko_1.wav","east/007_taiko_2.wav","east/008_taiko_3.wav"],space:["space/000_0.wav","space/001_1.wav","space/002_11.wav","space/003_12.wav","space/004_13.wav","space/005_14.wav","space/006_15.wav","space/007_16.wav","space/008_17.wav","space/009_18.wav","space/010_2.wav","space/011_3.wav","space/012_4.wav","space/013_5.wav","space/014_6.wav","space/015_7.wav","space/016_8.wav","space/017_9.wav"],numbers:["numbers/0.wav","numbers/1.wav","numbers/2.wav","numbers/3.wav","numbers/4.wav","numbers/5.wav","numbers/6.wav","numbers/7.wav","numbers/8.wav"],num:["num/00.wav","num/01.wav","num/02.wav","num/03.wav","num/04.wav","num/05.wav","num/06.wav","num/07.wav","num/08.wav","num/09.wav","num/10.wav","num/11.wav","num/12.wav","num/13.wav","num/14.wav","num/15.wav","num/16.wav","num/17.wav","num/18.wav","num/19.wav","num/20.wav"]},`${R}/Dirt-Samples/`,{prebake:!0})]),ns(`${R}/tidal-drum-machines-alias.json`)}const Oi=is("C8"),ji=(n,e)=>n*e+(1-e)/2;as.prototype.piano=function(){return this.fmap(n=>({...n,clip:n.clip??1})).s("piano").release(.1).fmap(n=>{const e=os(n),t=ji(Math.min(Math.round(e)/Oi,1),.5);return{...n,pan:(n.pan||1)*t}})};let Ke=(n,e)=>t=>{n.current!==t&&(n.current=t,e())};function ct(n,{keys:e,deps:t=[n,e]}={}){let s=We.useRef();s.current=n.get();let r=We.useCallback(a=>(Ke(s,a)(n.value),e?.length>0?ni(n,e,Ke(s,a)):n.listen(Ke(s,a))),t),i=()=>s.current;return We.useSyncExternalStore(r,i,i)}const Ri={webaudio:"webaudio",osc:"osc"},$i={USER:"user",DRUMS:"drums",SAMPLES:"samples",SYNTHS:"synths",WAVETABLES:"wavetables",ALL:"all"},Ci={activeFooter:"intro",keybindings:"codemirror",isBracketMatchingEnabled:!0,isBracketClosingEnabled:!0,isLineNumbersDisplayed:!0,isActiveLineHighlighted:!0,isAutoCompletionEnabled:!1,isTooltipEnabled:!1,isFlashEnabled:!0,isSyncEnabled:!1,isLineWrappingEnabled:!1,isPatternHighlightingEnabled:!0,isTabIndentationEnabled:!1,isMultiCursorEnabled:!1,theme:"strudelTheme",fontFamily:"monospace",fontSize:18,latestCode:"",isZen:!1,soundsFilter:$i.ALL,patternFilter:"community",panelPosition:"right",isPanelPinned:!1,isPanelOpen:!0,togglePanelTrigger:"click",userPatterns:"{}",audioEngineTarget:Ri.webaudio,isButtonRowHidden:!1,isCSSAnimationDisabled:!1,maxPolyphony:128,multiChannelOrbits:!1};let ys=null;typeof window<"u"&&(ys=new URLSearchParams(window.location.search));const kt=parseInt(ys?.get("instance")??"0"),xi=`strudel-settings${kt>0?kt:""}`,N=Js(xi,Ci),A=n=>!![!0,"true"].includes(n);function sc(){const n=ct(N),e=JSON.parse(n.userPatterns);return Object.keys(e).forEach(t=>{const s=e[t];s.id=s.id??t,e[t]=s}),{...n,isZen:A(n.isZen),isBracketMatchingEnabled:A(n.isBracketMatchingEnabled),isBracketClosingEnabled:A(n.isBracketClosingEnabled),isLineNumbersDisplayed:A(n.isLineNumbersDisplayed),isActiveLineHighlighted:A(n.isActiveLineHighlighted),isAutoCompletionEnabled:A(n.isAutoCompletionEnabled),isPatternHighlightingEnabled:A(n.isPatternHighlightingEnabled),isButtonRowHidden:A(n.isButtonRowHidden),isCSSAnimationDisabled:A(n.isCSSAnimationDisabled),isTooltipEnabled:A(n.isTooltipEnabled),isLineWrappingEnabled:A(n.isLineWrappingEnabled),isFlashEnabled:A(n.isFlashEnabled),isSyncEnabled:Kt()?!0:A(n.isSyncEnabled),isTabIndentationEnabled:A(n.isTabIndentationEnabled),isMultiCursorEnabled:A(n.isMultiCursorEnabled),fontSize:Number(n.fontSize),panelPosition:n.activeFooter!==""&&!Kt()?n.panelPosition:"bottom",isPanelPinned:A(n.isPanelPinned),isPanelOpen:A(n.isPanelOpen),userPatterns:e,multiChannelOrbits:A(n.multiChannelOrbits)}}const nc=n=>N.setKey("activeFooter",n),rc=n=>N.setKey("isPanelPinned",n),ic=n=>N.setKey("isPanelOpen",n),ac=n=>N.setKey("isZen",!!n),lt=n=>Yr(n,(e,t)=>t.onTrigger(()=>(e=Array.isArray(e)?e.join(" "):e,e!==N.get()[n]&&N.setKey(n,e),t),!1)),Ii=lt("theme"),Li=lt("fontFamily"),Di=lt("fontSize"),Ui={theme:Ii,fontFamily:Li,fontSize:Di},Bi=["by","url","genre","license"];function Mi(n){n==null&&(console.error("could not extract metadata from missing pattern code"),n="");const e=/\/\*([\s\S]*?)\*\/|\/\/(.*)$/gm,t=[...n.matchAll(e)].map(a=>(a[1]||a[2]||"").trim()),s={},[r,i]=(t[0]||"").split('"');r.trim()===""&&i!==void 0&&(s.title=i);for(const a of t){const o=a.split("@").slice(1);for(const c of o){let[l,u]=c.split(/ (.*)/s);if(l=l.trim(),u=(u||"").replaceAll(/ +/g," ").trim(),Bi.includes(l)){const d=u.split(/[,\n]/).map(h=>h.trim()).filter(h=>h!=="");s[l]=l in s?s[l].concat(d):d}else u=u.replaceAll(/\s+/g," "),s[l]=l in s?s[l]+" "+u:u}}return s}function oc(n,e=!1){return window.__TAURI_INTERNALS__.transformCallback(n,e)}async function Ni(n,e={},t){return window.__TAURI_INTERNALS__.invoke(n,e,t)}const bs=()=>window.__TAURI_IPC__!=null,Fi=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>E(async()=>{const{default:s}=await Promise.resolve().then(()=>de);return{default:s}},void 0).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)};class ut extends Error{constructor(e,t="FunctionsError",s){super(e),this.name=t,this.context=s}}class qi extends ut{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class zi extends ut{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Vi extends ut{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var et;(function(n){n.Any="any",n.ApNortheast1="ap-northeast-1",n.ApNortheast2="ap-northeast-2",n.ApSouth1="ap-south-1",n.ApSoutheast1="ap-southeast-1",n.ApSoutheast2="ap-southeast-2",n.CaCentral1="ca-central-1",n.EuCentral1="eu-central-1",n.EuWest1="eu-west-1",n.EuWest2="eu-west-2",n.EuWest3="eu-west-3",n.SaEast1="sa-east-1",n.UsEast1="us-east-1",n.UsWest1="us-west-1",n.UsWest2="us-west-2"})(et||(et={}));var Ji=function(n,e,t,s){function r(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(u){try{l(s.next(u))}catch(d){a(d)}}function c(u){try{l(s.throw(u))}catch(d){a(d)}}function l(u){u.done?i(u.value):r(u.value).then(o,c)}l((s=s.apply(n,e||[])).next())})};class Hi{constructor(e,{headers:t={},customFetch:s,region:r=et.Any}={}){this.url=e,this.headers=t,this.region=r,this.fetch=Fi(s)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var s;return Ji(this,void 0,void 0,function*(){try{const{headers:r,method:i,body:a}=t;let o={},{region:c}=t;c||(c=this.region),c&&c!=="any"&&(o["x-region"]=c);let l;a&&(r&&!Object.prototype.hasOwnProperty.call(r,"Content-Type")||!r)&&(typeof Blob<"u"&&a instanceof Blob||a instanceof ArrayBuffer?(o["Content-Type"]="application/octet-stream",l=a):typeof a=="string"?(o["Content-Type"]="text/plain",l=a):typeof FormData<"u"&&a instanceof FormData?l=a:(o["Content-Type"]="application/json",l=JSON.stringify(a)));const u=yield this.fetch(`${this.url}/${e}`,{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},o),this.headers),r),body:l}).catch(p=>{throw new qi(p)}),d=u.headers.get("x-relay-error");if(d&&d==="true")throw new zi(u);if(!u.ok)throw new Vi(u);let h=((s=u.headers.get("Content-Type"))!==null&&s!==void 0?s:"text/plain").split(";")[0].trim(),f;return h==="application/json"?f=yield u.json():h==="application/octet-stream"?f=yield u.blob():h==="text/event-stream"?f=u:h==="multipart/form-data"?f=yield u.formData():f=yield u.text(),{data:f,error:null}}catch(r){return{data:null,error:r}}})}}var j={},fe={},pe={},ge={},_e={},me={},Wi=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},ue=Wi();const Gi=ue.fetch,vs=ue.fetch.bind(ue),ks=ue.Headers,Ki=ue.Request,Qi=ue.Response,de=Object.freeze(Object.defineProperty({__proto__:null,Headers:ks,Request:Ki,Response:Qi,default:vs,fetch:Gi},Symbol.toStringTag,{value:"Module"})),Yi=ei(de);var $e={},St;function Ss(){if(St)return $e;St=1,Object.defineProperty($e,"__esModule",{value:!0});class n extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}}return $e.default=n,$e}var Et;function Es(){if(Et)return me;Et=1;var n=me.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(me,"__esModule",{value:!0});const e=n(Yi),t=n(Ss());class s{constructor(i){this.shouldThrowOnError=!1,this.method=i.method,this.url=i.url,this.headers=i.headers,this.schema=i.schema,this.body=i.body,this.shouldThrowOnError=i.shouldThrowOnError,this.signal=i.signal,this.isMaybeSingle=i.isMaybeSingle,i.fetch?this.fetch=i.fetch:typeof fetch>"u"?this.fetch=e.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(i,a){return this.headers=Object.assign({},this.headers),this.headers[i]=a,this}then(i,a){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const o=this.fetch;let c=o(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async l=>{var u,d,h;let f=null,p=null,_=null,g=l.status,y=l.statusText;if(l.ok){if(this.method!=="HEAD"){const w=await l.text();w===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?p=w:p=JSON.parse(w))}const S=(u=this.headers.Prefer)===null||u===void 0?void 0:u.match(/count=(exact|planned|estimated)/),k=(d=l.headers.get("content-range"))===null||d===void 0?void 0:d.split("/");S&&k&&k.length>1&&(_=parseInt(k[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(p)&&(p.length>1?(f={code:"PGRST116",details:`Results contain ${p.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},p=null,_=null,g=406,y="Not Acceptable"):p.length===1?p=p[0]:p=null)}else{const S=await l.text();try{f=JSON.parse(S),Array.isArray(f)&&l.status===404&&(p=[],f=null,g=200,y="OK")}catch{l.status===404&&S===""?(g=204,y="No Content"):f={message:S}}if(f&&this.isMaybeSingle&&(!((h=f?.details)===null||h===void 0)&&h.includes("0 rows"))&&(f=null,g=200,y="OK"),f&&this.shouldThrowOnError)throw new t.default(f)}return{error:f,data:p,count:_,status:g,statusText:y}});return this.shouldThrowOnError||(c=c.catch(l=>{var u,d,h;return{error:{message:`${(u=l?.name)!==null&&u!==void 0?u:"FetchError"}: ${l?.message}`,details:`${(d=l?.stack)!==null&&d!==void 0?d:""}`,hint:"",code:`${(h=l?.code)!==null&&h!==void 0?h:""}`},data:null,count:null,status:0,statusText:""}})),c.then(i,a)}}return me.default=s,me}var Tt;function Ts(){if(Tt)return _e;Tt=1;var n=_e.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(_e,"__esModule",{value:!0});const e=n(Es());class t extends e.default{select(r){let i=!1;const a=(r??"*").split("").map(o=>/\s/.test(o)&&!i?"":(o==='"'&&(i=!i),o)).join("");return this.url.searchParams.set("select",a),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(r,{ascending:i=!0,nullsFirst:a,foreignTable:o,referencedTable:c=o}={}){const l=c?`${c}.order`:"order",u=this.url.searchParams.get(l);return this.url.searchParams.set(l,`${u?`${u},`:""}${r}.${i?"asc":"desc"}${a===void 0?"":a?".nullsfirst":".nullslast"}`),this}limit(r,{foreignTable:i,referencedTable:a=i}={}){const o=typeof a>"u"?"limit":`${a}.limit`;return this.url.searchParams.set(o,`${r}`),this}range(r,i,{foreignTable:a,referencedTable:o=a}={}){const c=typeof o>"u"?"offset":`${o}.offset`,l=typeof o>"u"?"limit":`${o}.limit`;return this.url.searchParams.set(c,`${r}`),this.url.searchParams.set(l,`${i-r+1}`),this}abortSignal(r){return this.signal=r,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:r=!1,verbose:i=!1,settings:a=!1,buffers:o=!1,wal:c=!1,format:l="text"}={}){var u;const d=[r?"analyze":null,i?"verbose":null,a?"settings":null,o?"buffers":null,c?"wal":null].filter(Boolean).join("|"),h=(u=this.headers.Accept)!==null&&u!==void 0?u:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${l}; for="${h}"; options=${d};`,l==="json"?this:this}rollback(){var r;return((r=this.headers.Prefer)!==null&&r!==void 0?r:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}return _e.default=t,_e}var Pt;function dt(){if(Pt)return ge;Pt=1;var n=ge.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(ge,"__esModule",{value:!0});const e=n(Ts());class t extends e.default{eq(r,i){return this.url.searchParams.append(r,`eq.${i}`),this}neq(r,i){return this.url.searchParams.append(r,`neq.${i}`),this}gt(r,i){return this.url.searchParams.append(r,`gt.${i}`),this}gte(r,i){return this.url.searchParams.append(r,`gte.${i}`),this}lt(r,i){return this.url.searchParams.append(r,`lt.${i}`),this}lte(r,i){return this.url.searchParams.append(r,`lte.${i}`),this}like(r,i){return this.url.searchParams.append(r,`like.${i}`),this}likeAllOf(r,i){return this.url.searchParams.append(r,`like(all).{${i.join(",")}}`),this}likeAnyOf(r,i){return this.url.searchParams.append(r,`like(any).{${i.join(",")}}`),this}ilike(r,i){return this.url.searchParams.append(r,`ilike.${i}`),this}ilikeAllOf(r,i){return this.url.searchParams.append(r,`ilike(all).{${i.join(",")}}`),this}ilikeAnyOf(r,i){return this.url.searchParams.append(r,`ilike(any).{${i.join(",")}}`),this}is(r,i){return this.url.searchParams.append(r,`is.${i}`),this}in(r,i){const a=Array.from(new Set(i)).map(o=>typeof o=="string"&&new RegExp("[,()]").test(o)?`"${o}"`:`${o}`).join(",");return this.url.searchParams.append(r,`in.(${a})`),this}contains(r,i){return typeof i=="string"?this.url.searchParams.append(r,`cs.${i}`):Array.isArray(i)?this.url.searchParams.append(r,`cs.{${i.join(",")}}`):this.url.searchParams.append(r,`cs.${JSON.stringify(i)}`),this}containedBy(r,i){return typeof i=="string"?this.url.searchParams.append(r,`cd.${i}`):Array.isArray(i)?this.url.searchParams.append(r,`cd.{${i.join(",")}}`):this.url.searchParams.append(r,`cd.${JSON.stringify(i)}`),this}rangeGt(r,i){return this.url.searchParams.append(r,`sr.${i}`),this}rangeGte(r,i){return this.url.searchParams.append(r,`nxl.${i}`),this}rangeLt(r,i){return this.url.searchParams.append(r,`sl.${i}`),this}rangeLte(r,i){return this.url.searchParams.append(r,`nxr.${i}`),this}rangeAdjacent(r,i){return this.url.searchParams.append(r,`adj.${i}`),this}overlaps(r,i){return typeof i=="string"?this.url.searchParams.append(r,`ov.${i}`):this.url.searchParams.append(r,`ov.{${i.join(",")}}`),this}textSearch(r,i,{config:a,type:o}={}){let c="";o==="plain"?c="pl":o==="phrase"?c="ph":o==="websearch"&&(c="w");const l=a===void 0?"":`(${a})`;return this.url.searchParams.append(r,`${c}fts${l}.${i}`),this}match(r){return Object.entries(r).forEach(([i,a])=>{this.url.searchParams.append(i,`eq.${a}`)}),this}not(r,i,a){return this.url.searchParams.append(r,`not.${i}.${a}`),this}or(r,{foreignTable:i,referencedTable:a=i}={}){const o=a?`${a}.or`:"or";return this.url.searchParams.append(o,`(${r})`),this}filter(r,i,a){return this.url.searchParams.append(r,`${i}.${a}`),this}}return ge.default=t,ge}var At;function Ps(){if(At)return pe;At=1;var n=pe.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(pe,"__esModule",{value:!0});const e=n(dt());class t{constructor(r,{headers:i={},schema:a,fetch:o}){this.url=r,this.headers=i,this.schema=a,this.fetch=o}select(r,{head:i=!1,count:a}={}){const o=i?"HEAD":"GET";let c=!1;const l=(r??"*").split("").map(u=>/\s/.test(u)&&!c?"":(u==='"'&&(c=!c),u)).join("");return this.url.searchParams.set("select",l),a&&(this.headers.Prefer=`count=${a}`),new e.default({method:o,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(r,{count:i,defaultToNull:a=!0}={}){const o="POST",c=[];if(this.headers.Prefer&&c.push(this.headers.Prefer),i&&c.push(`count=${i}`),a||c.push("missing=default"),this.headers.Prefer=c.join(","),Array.isArray(r)){const l=r.reduce((u,d)=>u.concat(Object.keys(d)),[]);if(l.length>0){const u=[...new Set(l)].map(d=>`"${d}"`);this.url.searchParams.set("columns",u.join(","))}}return new e.default({method:o,url:this.url,headers:this.headers,schema:this.schema,body:r,fetch:this.fetch,allowEmpty:!1})}upsert(r,{onConflict:i,ignoreDuplicates:a=!1,count:o,defaultToNull:c=!0}={}){const l="POST",u=[`resolution=${a?"ignore":"merge"}-duplicates`];if(i!==void 0&&this.url.searchParams.set("on_conflict",i),this.headers.Prefer&&u.push(this.headers.Prefer),o&&u.push(`count=${o}`),c||u.push("missing=default"),this.headers.Prefer=u.join(","),Array.isArray(r)){const d=r.reduce((h,f)=>h.concat(Object.keys(f)),[]);if(d.length>0){const h=[...new Set(d)].map(f=>`"${f}"`);this.url.searchParams.set("columns",h.join(","))}}return new e.default({method:l,url:this.url,headers:this.headers,schema:this.schema,body:r,fetch:this.fetch,allowEmpty:!1})}update(r,{count:i}={}){const a="PATCH",o=[];return this.headers.Prefer&&o.push(this.headers.Prefer),i&&o.push(`count=${i}`),this.headers.Prefer=o.join(","),new e.default({method:a,url:this.url,headers:this.headers,schema:this.schema,body:r,fetch:this.fetch,allowEmpty:!1})}delete({count:r}={}){const i="DELETE",a=[];return r&&a.push(`count=${r}`),this.headers.Prefer&&a.unshift(this.headers.Prefer),this.headers.Prefer=a.join(","),new e.default({method:i,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}return pe.default=t,pe}var we={},ye={},Ot;function Xi(){return Ot||(Ot=1,Object.defineProperty(ye,"__esModule",{value:!0}),ye.version=void 0,ye.version="0.0.0-automated"),ye}var jt;function Zi(){if(jt)return we;jt=1,Object.defineProperty(we,"__esModule",{value:!0}),we.DEFAULT_HEADERS=void 0;const n=Xi();return we.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${n.version}`},we}var Rt;function ea(){if(Rt)return fe;Rt=1;var n=fe.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(fe,"__esModule",{value:!0});const e=n(Ps()),t=n(dt()),s=Zi();class r{constructor(a,{headers:o={},schema:c,fetch:l}={}){this.url=a,this.headers=Object.assign(Object.assign({},s.DEFAULT_HEADERS),o),this.schemaName=c,this.fetch=l}from(a){const o=new URL(`${this.url}/${a}`);return new e.default(o,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(a){return new r(this.url,{headers:this.headers,schema:a,fetch:this.fetch})}rpc(a,o={},{head:c=!1,get:l=!1,count:u}={}){let d;const h=new URL(`${this.url}/rpc/${a}`);let f;c||l?(d=c?"HEAD":"GET",Object.entries(o).filter(([_,g])=>g!==void 0).map(([_,g])=>[_,Array.isArray(g)?`{${g.join(",")}}`:`${g}`]).forEach(([_,g])=>{h.searchParams.append(_,g)})):(d="POST",f=o);const p=Object.assign({},this.headers);return u&&(p.Prefer=`count=${u}`),new t.default({method:d,url:h,headers:p,schema:this.schemaName,body:f,fetch:this.fetch,allowEmpty:!1})}}return fe.default=r,fe}var $t;function ta(){if($t)return j;$t=1;var n=j.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(j,"__esModule",{value:!0}),j.PostgrestError=j.PostgrestBuilder=j.PostgrestTransformBuilder=j.PostgrestFilterBuilder=j.PostgrestQueryBuilder=j.PostgrestClient=void 0;const e=n(ea());j.PostgrestClient=e.default;const t=n(Ps());j.PostgrestQueryBuilder=t.default;const s=n(dt());j.PostgrestFilterBuilder=s.default;const r=n(Ts());j.PostgrestTransformBuilder=r.default;const i=n(Es());j.PostgrestBuilder=i.default;const a=n(Ss());return j.PostgrestError=a.default,j.default={PostgrestClient:e.default,PostgrestQueryBuilder:t.default,PostgrestFilterBuilder:s.default,PostgrestTransformBuilder:r.default,PostgrestBuilder:i.default,PostgrestError:a.default},j}var sa=ta();const na=ti(sa),{PostgrestClient:ra,PostgrestQueryBuilder:cc,PostgrestFilterBuilder:lc,PostgrestTransformBuilder:uc,PostgrestBuilder:dc,PostgrestError:hc}=na,ia="2.11.2",aa={"X-Client-Info":`realtime-js/${ia}`},oa="1.0.0",As=1e4,ca=1e3;var le;(function(n){n[n.connecting=0]="connecting",n[n.open=1]="open",n[n.closing=2]="closing",n[n.closed=3]="closed"})(le||(le={}));var C;(function(n){n.closed="closed",n.errored="errored",n.joined="joined",n.joining="joining",n.leaving="leaving"})(C||(C={}));var L;(function(n){n.close="phx_close",n.error="phx_error",n.join="phx_join",n.reply="phx_reply",n.leave="phx_leave",n.access_token="access_token"})(L||(L={}));var tt;(function(n){n.websocket="websocket"})(tt||(tt={}));var X;(function(n){n.Connecting="connecting",n.Open="open",n.Closing="closing",n.Closed="closed"})(X||(X={}));class la{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),s=new TextDecoder;return this._decodeBroadcast(e,t,s)}_decodeBroadcast(e,t,s){const r=t.getUint8(1),i=t.getUint8(2);let a=this.HEADER_LENGTH+2;const o=s.decode(e.slice(a,a+r));a=a+r;const c=s.decode(e.slice(a,a+i));a=a+i;const l=JSON.parse(s.decode(e.slice(a,e.byteLength)));return{ref:null,topic:o,event:c,payload:l}}}class Os{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var T;(function(n){n.abstime="abstime",n.bool="bool",n.date="date",n.daterange="daterange",n.float4="float4",n.float8="float8",n.int2="int2",n.int4="int4",n.int4range="int4range",n.int8="int8",n.int8range="int8range",n.json="json",n.jsonb="jsonb",n.money="money",n.numeric="numeric",n.oid="oid",n.reltime="reltime",n.text="text",n.time="time",n.timestamp="timestamp",n.timestamptz="timestamptz",n.timetz="timetz",n.tsrange="tsrange",n.tstzrange="tstzrange"})(T||(T={}));const Ct=(n,e,t={})=>{var s;const r=(s=t.skipTypes)!==null&&s!==void 0?s:[];return Object.keys(e).reduce((i,a)=>(i[a]=ua(a,n,e,r),i),{})},ua=(n,e,t,s)=>{const r=e.find(o=>o.name===n),i=r?.type,a=t[n];return i&&!s.includes(i)?js(i,a):st(a)},js=(n,e)=>{if(n.charAt(0)==="_"){const t=n.slice(1,n.length);return pa(e,t)}switch(n){case T.bool:return da(e);case T.float4:case T.float8:case T.int2:case T.int4:case T.int8:case T.numeric:case T.oid:return ha(e);case T.json:case T.jsonb:return fa(e);case T.timestamp:return ga(e);case T.abstime:case T.date:case T.daterange:case T.int4range:case T.int8range:case T.money:case T.reltime:case T.text:case T.time:case T.timestamptz:case T.timetz:case T.tsrange:case T.tstzrange:return st(e);default:return st(e)}},st=n=>n,da=n=>{switch(n){case"t":return!0;case"f":return!1;default:return n}},ha=n=>{if(typeof n=="string"){const e=parseFloat(n);if(!Number.isNaN(e))return e}return n},fa=n=>{if(typeof n=="string")try{return JSON.parse(n)}catch(e){return console.log(`JSON parse error: ${e}`),n}return n},pa=(n,e)=>{if(typeof n!="string")return n;const t=n.length-1,s=n[t];if(n[0]==="{"&&s==="}"){let i;const a=n.slice(1,t);try{i=JSON.parse("["+a+"]")}catch{i=a?a.split(","):[]}return i.map(o=>js(e,o))}return n},ga=n=>typeof n=="string"?n.replace(" ","T"):n,Rs=n=>{let e=n;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")};class Qe{constructor(e,t,s={},r=As){this.channel=e,this.event=t,this.payload=s,this.timeout=r,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var s;return this._hasReceived(e)&&t((s=this.receivedResp)===null||s===void 0?void 0:s.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(s=>s.status===e).forEach(s=>s.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var xt;(function(n){n.SYNC="sync",n.JOIN="join",n.LEAVE="leave"})(xt||(xt={}));class Se{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const s=t?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},r=>{const{onJoin:i,onLeave:a,onSync:o}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Se.syncState(this.state,r,i,a),this.pendingDiffs.forEach(c=>{this.state=Se.syncDiff(this.state,c,i,a)}),this.pendingDiffs=[],o()}),this.channel._on(s.diff,{},r=>{const{onJoin:i,onLeave:a,onSync:o}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(r):(this.state=Se.syncDiff(this.state,r,i,a),o())}),this.onJoin((r,i,a)=>{this.channel._trigger("presence",{event:"join",key:r,currentPresences:i,newPresences:a})}),this.onLeave((r,i,a)=>{this.channel._trigger("presence",{event:"leave",key:r,currentPresences:i,leftPresences:a})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,s,r){const i=this.cloneDeep(e),a=this.transformState(t),o={},c={};return this.map(i,(l,u)=>{a[l]||(c[l]=u)}),this.map(a,(l,u)=>{const d=i[l];if(d){const h=u.map(g=>g.presence_ref),f=d.map(g=>g.presence_ref),p=u.filter(g=>f.indexOf(g.presence_ref)<0),_=d.filter(g=>h.indexOf(g.presence_ref)<0);p.length>0&&(o[l]=p),_.length>0&&(c[l]=_)}else o[l]=u}),this.syncDiff(i,{joins:o,leaves:c},s,r)}static syncDiff(e,t,s,r){const{joins:i,leaves:a}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return s||(s=()=>{}),r||(r=()=>{}),this.map(i,(o,c)=>{var l;const u=(l=e[o])!==null&&l!==void 0?l:[];if(e[o]=this.cloneDeep(c),u.length>0){const d=e[o].map(f=>f.presence_ref),h=u.filter(f=>d.indexOf(f.presence_ref)<0);e[o].unshift(...h)}s(o,u,c)}),this.map(a,(o,c)=>{let l=e[o];if(!l)return;const u=c.map(d=>d.presence_ref);l=l.filter(d=>u.indexOf(d.presence_ref)<0),e[o]=l,r(o,l,c),l.length===0&&delete e[o]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(s=>t(s,e[s]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,s)=>{const r=e[s];return"metas"in r?t[s]=r.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):t[s]=r,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var It;(function(n){n.ALL="*",n.INSERT="INSERT",n.UPDATE="UPDATE",n.DELETE="DELETE"})(It||(It={}));var Lt;(function(n){n.BROADCAST="broadcast",n.PRESENCE="presence",n.POSTGRES_CHANGES="postgres_changes",n.SYSTEM="system"})(Lt||(Lt={}));var F;(function(n){n.SUBSCRIBED="SUBSCRIBED",n.TIMED_OUT="TIMED_OUT",n.CLOSED="CLOSED",n.CHANNEL_ERROR="CHANNEL_ERROR"})(F||(F={}));class ht{constructor(e,t={config:{}},s){this.topic=e,this.params=t,this.socket=s,this.bindings={},this.state=C.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new Qe(this,L.join,this.params,this.timeout),this.rejoinTimer=new Os(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=C.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(r=>r.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=C.closed,this.socket._remove(this)}),this._onError(r=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,r),this.state=C.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=C.errored,this.rejoinTimer.scheduleTimeout())}),this._on(L.reply,{},(r,i)=>{this._trigger(this._replyEventName(i),r)}),this.presence=new Se(this),this.broadcastEndpointURL=Rs(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var s,r;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:i,presence:a,private:o}}=this.params;this._onError(u=>e?.(F.CHANNEL_ERROR,u)),this._onClose(()=>e?.(F.CLOSED));const c={},l={broadcast:i,presence:a,postgres_changes:(r=(s=this.bindings.postgres_changes)===null||s===void 0?void 0:s.map(u=>u.filter))!==null&&r!==void 0?r:[],private:o};this.socket.accessTokenValue&&(c.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:l},c)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:u})=>{var d;if(this.socket.setAuth(),u===void 0){e?.(F.SUBSCRIBED);return}else{const h=this.bindings.postgres_changes,f=(d=h?.length)!==null&&d!==void 0?d:0,p=[];for(let _=0;_<f;_++){const g=h[_],{filter:{event:y,schema:m,table:S,filter:k}}=g,w=u&&u[_];if(w&&w.event===y&&w.schema===m&&w.table===S&&w.filter===k)p.push(Object.assign(Object.assign({},g),{id:w.id}));else{this.unsubscribe(),e?.(F.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=p,e&&e(F.SUBSCRIBED);return}}).receive("error",u=>{e?.(F.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(u).join(", ")||"error")))}).receive("timeout",()=>{e?.(F.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,s){return this._on(e,t,s)}async send(e,t={}){var s,r;if(!this._canPush()&&e.type==="broadcast"){const{event:i,payload:a}=e,c={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:a,private:this.private}]})};try{const l=await this._fetchWithTimeout(this.broadcastEndpointURL,c,(s=t.timeout)!==null&&s!==void 0?s:this.timeout);return await((r=l.body)===null||r===void 0?void 0:r.cancel()),l.ok?"ok":"error"}catch(l){return l.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var a,o,c;const l=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((c=(o=(a=this.params)===null||a===void 0?void 0:a.config)===null||o===void 0?void 0:o.broadcast)===null||c===void 0)&&c.ack)&&i("ok"),l.receive("ok",()=>i("ok")),l.receive("error",()=>i("error")),l.receive("timeout",()=>i("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=C.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(L.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(s=>{const r=new Qe(this,L.leave,{},e);r.receive("ok",()=>{t(),s("ok")}).receive("timeout",()=>{t(),s("timed out")}).receive("error",()=>{s("error")}),r.send(),this._canPush()||r.trigger("ok",{})})}async _fetchWithTimeout(e,t,s){const r=new AbortController,i=setTimeout(()=>r.abort(),s),a=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:r.signal}));return clearTimeout(i),a}_push(e,t,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let r=new Qe(this,e,t,s);return this._canPush()?r.send():(r.startTimeout(),this.pushBuffer.push(r)),r}_onMessage(e,t,s){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,s){var r,i;const a=e.toLocaleLowerCase(),{close:o,error:c,leave:l,join:u}=L;if(s&&[o,c,l,u].indexOf(a)>=0&&s!==this._joinRef())return;let h=this._onMessage(a,t,s);if(t&&!h)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(a)?(r=this.bindings.postgres_changes)===null||r===void 0||r.filter(f=>{var p,_,g;return((p=f.filter)===null||p===void 0?void 0:p.event)==="*"||((g=(_=f.filter)===null||_===void 0?void 0:_.event)===null||g===void 0?void 0:g.toLocaleLowerCase())===a}).map(f=>f.callback(h,s)):(i=this.bindings[a])===null||i===void 0||i.filter(f=>{var p,_,g,y,m,S;if(["broadcast","presence","postgres_changes"].includes(a))if("id"in f){const k=f.id,w=(p=f.filter)===null||p===void 0?void 0:p.event;return k&&((_=t.ids)===null||_===void 0?void 0:_.includes(k))&&(w==="*"||w?.toLocaleLowerCase()===((g=t.data)===null||g===void 0?void 0:g.type.toLocaleLowerCase()))}else{const k=(m=(y=f?.filter)===null||y===void 0?void 0:y.event)===null||m===void 0?void 0:m.toLocaleLowerCase();return k==="*"||k===((S=t?.event)===null||S===void 0?void 0:S.toLocaleLowerCase())}else return f.type.toLocaleLowerCase()===a}).map(f=>{if(typeof h=="object"&&"ids"in h){const p=h.data,{schema:_,table:g,commit_timestamp:y,type:m,errors:S}=p;h=Object.assign(Object.assign({},{schema:_,table:g,commit_timestamp:y,eventType:m,new:{},old:{},errors:S}),this._getPayloadRecords(p))}f.callback(h,s)})}_isClosed(){return this.state===C.closed}_isJoined(){return this.state===C.joined}_isJoining(){return this.state===C.joining}_isLeaving(){return this.state===C.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,s){const r=e.toLocaleLowerCase(),i={type:r,filter:t,callback:s};return this.bindings[r]?this.bindings[r].push(i):this.bindings[r]=[i],this}_off(e,t){const s=e.toLocaleLowerCase();return this.bindings[s]=this.bindings[s].filter(r=>{var i;return!(((i=r.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===s&&ht.isEqual(r.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const s in e)if(e[s]!==t[s])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(L.close,{},e)}_onError(e){this._on(L.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=C.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=Ct(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=Ct(e.columns,e.old_record)),t}}const _a=()=>{},ma=typeof WebSocket<"u",wa=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class ya{constructor(e,t){var s;this.accessTokenValue=null,this.apiKey=null,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers=aa,this.params={},this.timeout=As,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=_a,this.conn=null,this.sendBuffer=[],this.serializer=new la,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=i=>{let a;return i?a=i:typeof fetch>"u"?a=(...o)=>E(async()=>{const{default:c}=await Promise.resolve().then(()=>de);return{default:c}},void 0).then(({default:c})=>c(...o)):a=fetch,(...o)=>a(...o)},this.endPoint=`${e}/${tt.websocket}`,this.httpEndpoint=Rs(e),t?.transport?this.transport=t.transport:this.transport=null,t?.params&&(this.params=t.params),t?.headers&&(this.headers=Object.assign(Object.assign({},this.headers),t.headers)),t?.timeout&&(this.timeout=t.timeout),t?.logger&&(this.logger=t.logger),t?.heartbeatIntervalMs&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const r=(s=t?.params)===null||s===void 0?void 0:s.apikey;if(r&&(this.accessTokenValue=r,this.apiKey=r),this.reconnectAfterMs=t?.reconnectAfterMs?t.reconnectAfterMs:i=>[1e3,2e3,5e3,1e4][i-1]||1e4,this.encode=t?.encode?t.encode:(i,a)=>a(JSON.stringify(i)),this.decode=t?.decode?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new Os(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(t?.fetch),t?.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=t?.worker||!1,this.workerUrl=t?.workerUrl}this.accessToken=t?.accessToken||null}connect(){if(!this.conn){if(this.transport){this.conn=new this.transport(this.endpointURL(),void 0,{headers:this.headers});return}if(ma){this.conn=new WebSocket(this.endpointURL()),this.setupConnection();return}this.conn=new ba(this.endpointURL(),void 0,{close:()=>{this.conn=null}}),E(async()=>{const{default:e}=await import("./browser.DeD4NJl7.js").then(t=>t.b);return{default:e}},__vite__mapDeps([4,5])).then(({default:e})=>{this.conn=new e(this.endpointURL(),void 0,{headers:this.headers}),this.setupConnection()})}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:oa}))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.disconnect(),e}log(e,t,s){this.logger(e,t,s)}connectionState(){switch(this.conn&&this.conn.readyState){case le.connecting:return X.Connecting;case le.open:return X.Open;case le.closing:return X.Closing;default:return X.Closed}}isConnected(){return this.connectionState()===X.Open}channel(e,t={config:{}}){const s=new ht(`realtime:${e}`,t,this);return this.channels.push(s),s}push(e){const{topic:t,event:s,payload:r,ref:i}=e,a=()=>{this.encode(e,o=>{var c;(c=this.conn)===null||c===void 0||c.send(o)})};this.log("push",`${t} ${s} (${i})`,r),this.isConnected()?a():this.sendBuffer.push(a)}async setAuth(e=null){let t=e||this.accessToken&&await this.accessToken()||this.accessTokenValue;if(t){let s=null;try{s=JSON.parse(atob(t.split(".")[1]))}catch{}if(s&&s.exp&&!(Math.floor(Date.now()/1e3)-s.exp<0))return this.log("auth",`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${s.exp}`),Promise.reject(`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${s.exp}`);this.accessTokenValue=t,this.channels.forEach(r=>{t&&r.updateJoinPayload({access_token:t}),r.joinedOnce&&r._isJoined()&&r._push(L.access_token,{access_token:t})})}}async sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(e=this.conn)===null||e===void 0||e.close(ca,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth()}}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(s=>s.topic===e&&(s._isJoined()||s._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t._joinRef()!==e._joinRef())}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,t=>{let{topic:s,event:r,payload:i,ref:a}=t;a&&a===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${i.status||""} ${s} ${r} ${a&&"("+a+")"||""}`,i),this.channels.filter(o=>o._isMember(s)).forEach(o=>o._trigger(r,i,a)),this.stateChangeCallbacks.message.forEach(o=>o(t))})}async _onConnOpen(){if(this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),!this.worker)this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs);else{this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}this.stateChangeCallbacks.open.forEach(e=>e())}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(L.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const s=e.match(/\?/)?"&":"?",r=new URLSearchParams(t);return`${e}${s}${r}`}_workerObjectUrl(e){let t;if(e)t=e;else{const s=new Blob([wa],{type:"application/javascript"});t=URL.createObjectURL(s)}return t}}class ba{constructor(e,t,s){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=le.connecting,this.send=()=>{},this.url=null,this.url=e,this.close=s.close}}class ft extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function O(n){return typeof n=="object"&&n!==null&&"__isStorageError"in n}class va extends ft{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class nt extends ft{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var ka=function(n,e,t,s){function r(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(u){try{l(s.next(u))}catch(d){a(d)}}function c(u){try{l(s.throw(u))}catch(d){a(d)}}function l(u){u.done?i(u.value):r(u.value).then(o,c)}l((s=s.apply(n,e||[])).next())})};const $s=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>E(async()=>{const{default:s}=await Promise.resolve().then(()=>de);return{default:s}},void 0).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)},Sa=()=>ka(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield E(()=>Promise.resolve().then(()=>de),void 0)).Response:Response}),rt=n=>{if(Array.isArray(n))return n.map(t=>rt(t));if(typeof n=="function"||n!==Object(n))return n;const e={};return Object.entries(n).forEach(([t,s])=>{const r=t.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));e[r]=rt(s)}),e};var Z=function(n,e,t,s){function r(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(u){try{l(s.next(u))}catch(d){a(d)}}function c(u){try{l(s.throw(u))}catch(d){a(d)}}function l(u){u.done?i(u.value):r(u.value).then(o,c)}l((s=s.apply(n,e||[])).next())})};const Ye=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),Ea=(n,e,t)=>Z(void 0,void 0,void 0,function*(){const s=yield Sa();n instanceof s&&!t?.noResolveJson?n.json().then(r=>{e(new va(Ye(r),n.status||500))}).catch(r=>{e(new nt(Ye(r),r))}):e(new nt(Ye(n),n))}),Ta=(n,e,t,s)=>{const r={method:n,headers:e?.headers||{}};return n==="GET"?r:(r.headers=Object.assign({"Content-Type":"application/json"},e?.headers),s&&(r.body=JSON.stringify(s)),Object.assign(Object.assign({},r),t))};function Ae(n,e,t,s,r,i){return Z(this,void 0,void 0,function*(){return new Promise((a,o)=>{n(t,Ta(e,s,r,i)).then(c=>{if(!c.ok)throw c;return s?.noResolveJson?c:c.json()}).then(c=>a(c)).catch(c=>Ea(c,o,s))})})}function ze(n,e,t,s){return Z(this,void 0,void 0,function*(){return Ae(n,"GET",e,t,s)})}function G(n,e,t,s,r){return Z(this,void 0,void 0,function*(){return Ae(n,"POST",e,s,r,t)})}function Pa(n,e,t,s,r){return Z(this,void 0,void 0,function*(){return Ae(n,"PUT",e,s,r,t)})}function Aa(n,e,t,s){return Z(this,void 0,void 0,function*(){return Ae(n,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),s)})}function Cs(n,e,t,s,r){return Z(this,void 0,void 0,function*(){return Ae(n,"DELETE",e,s,r,t)})}var $=function(n,e,t,s){function r(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(u){try{l(s.next(u))}catch(d){a(d)}}function c(u){try{l(s.throw(u))}catch(d){a(d)}}function l(u){u.done?i(u.value):r(u.value).then(o,c)}l((s=s.apply(n,e||[])).next())})};const Oa={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Dt={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class ja{constructor(e,t={},s,r){this.url=e,this.headers=t,this.bucketId=s,this.fetch=$s(r)}uploadOrUpdate(e,t,s,r){return $(this,void 0,void 0,function*(){try{let i;const a=Object.assign(Object.assign({},Dt),r);let o=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(a.upsert)});const c=a.metadata;typeof Blob<"u"&&s instanceof Blob?(i=new FormData,i.append("cacheControl",a.cacheControl),c&&i.append("metadata",this.encodeMetadata(c)),i.append("",s)):typeof FormData<"u"&&s instanceof FormData?(i=s,i.append("cacheControl",a.cacheControl),c&&i.append("metadata",this.encodeMetadata(c))):(i=s,o["cache-control"]=`max-age=${a.cacheControl}`,o["content-type"]=a.contentType,c&&(o["x-metadata"]=this.toBase64(this.encodeMetadata(c)))),r?.headers&&(o=Object.assign(Object.assign({},o),r.headers));const l=this._removeEmptyFolders(t),u=this._getFinalPath(l),d=yield this.fetch(`${this.url}/object/${u}`,Object.assign({method:e,body:i,headers:o},a?.duplex?{duplex:a.duplex}:{})),h=yield d.json();return d.ok?{data:{path:l,id:h.Id,fullPath:h.Key},error:null}:{data:null,error:h}}catch(i){if(O(i))return{data:null,error:i};throw i}})}upload(e,t,s){return $(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,s)})}uploadToSignedUrl(e,t,s,r){return $(this,void 0,void 0,function*(){const i=this._removeEmptyFolders(e),a=this._getFinalPath(i),o=new URL(this.url+`/object/upload/sign/${a}`);o.searchParams.set("token",t);try{let c;const l=Object.assign({upsert:Dt.upsert},r),u=Object.assign(Object.assign({},this.headers),{"x-upsert":String(l.upsert)});typeof Blob<"u"&&s instanceof Blob?(c=new FormData,c.append("cacheControl",l.cacheControl),c.append("",s)):typeof FormData<"u"&&s instanceof FormData?(c=s,c.append("cacheControl",l.cacheControl)):(c=s,u["cache-control"]=`max-age=${l.cacheControl}`,u["content-type"]=l.contentType);const d=yield this.fetch(o.toString(),{method:"PUT",body:c,headers:u}),h=yield d.json();return d.ok?{data:{path:i,fullPath:h.Key},error:null}:{data:null,error:h}}catch(c){if(O(c))return{data:null,error:c};throw c}})}createSignedUploadUrl(e,t){return $(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e);const r=Object.assign({},this.headers);t?.upsert&&(r["x-upsert"]="true");const i=yield G(this.fetch,`${this.url}/object/upload/sign/${s}`,{},{headers:r}),a=new URL(this.url+i.url),o=a.searchParams.get("token");if(!o)throw new ft("No token returned by API");return{data:{signedUrl:a.toString(),path:e,token:o},error:null}}catch(s){if(O(s))return{data:null,error:s};throw s}})}update(e,t,s){return $(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,s)})}move(e,t,s){return $(this,void 0,void 0,function*(){try{return{data:yield G(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:s?.destinationBucket},{headers:this.headers}),error:null}}catch(r){if(O(r))return{data:null,error:r};throw r}})}copy(e,t,s){return $(this,void 0,void 0,function*(){try{return{data:{path:(yield G(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:s?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(r){if(O(r))return{data:null,error:r};throw r}})}createSignedUrl(e,t,s){return $(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e),i=yield G(this.fetch,`${this.url}/object/sign/${r}`,Object.assign({expiresIn:t},s?.transform?{transform:s.transform}:{}),{headers:this.headers});const a=s?.download?`&download=${s.download===!0?"":s.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${a}`)},{data:i,error:null}}catch(r){if(O(r))return{data:null,error:r};throw r}})}createSignedUrls(e,t,s){return $(this,void 0,void 0,function*(){try{const r=yield G(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),i=s?.download?`&download=${s.download===!0?"":s.download}`:"";return{data:r.map(a=>Object.assign(Object.assign({},a),{signedUrl:a.signedURL?encodeURI(`${this.url}${a.signedURL}${i}`):null})),error:null}}catch(r){if(O(r))return{data:null,error:r};throw r}})}download(e,t){return $(this,void 0,void 0,function*(){const r=typeof t?.transform<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString(t?.transform||{}),a=i?`?${i}`:"";try{const o=this._getFinalPath(e);return{data:yield(yield ze(this.fetch,`${this.url}/${r}/${o}${a}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(o){if(O(o))return{data:null,error:o};throw o}})}info(e){return $(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const s=yield ze(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:rt(s),error:null}}catch(s){if(O(s))return{data:null,error:s};throw s}})}exists(e){return $(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield Aa(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(s){if(O(s)&&s instanceof nt){const r=s.originalError;if([400,404].includes(r?.status))return{data:!1,error:s}}throw s}})}getPublicUrl(e,t){const s=this._getFinalPath(e),r=[],i=t?.download?`download=${t.download===!0?"":t.download}`:"";i!==""&&r.push(i);const o=typeof t?.transform<"u"?"render/image":"object",c=this.transformOptsToQueryString(t?.transform||{});c!==""&&r.push(c);let l=r.join("&");return l!==""&&(l=`?${l}`),{data:{publicUrl:encodeURI(`${this.url}/${o}/public/${s}${l}`)}}}remove(e){return $(this,void 0,void 0,function*(){try{return{data:yield Cs(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(O(t))return{data:null,error:t};throw t}})}list(e,t,s){return $(this,void 0,void 0,function*(){try{const r=Object.assign(Object.assign(Object.assign({},Oa),t),{prefix:e||""});return{data:yield G(this.fetch,`${this.url}/object/list/${this.bucketId}`,r,{headers:this.headers},s),error:null}}catch(r){if(O(r))return{data:null,error:r};throw r}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const Ra="2.7.1",$a={"X-Client-Info":`storage-js/${Ra}`};var ne=function(n,e,t,s){function r(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(u){try{l(s.next(u))}catch(d){a(d)}}function c(u){try{l(s.throw(u))}catch(d){a(d)}}function l(u){u.done?i(u.value):r(u.value).then(o,c)}l((s=s.apply(n,e||[])).next())})};class Ca{constructor(e,t={},s){this.url=e,this.headers=Object.assign(Object.assign({},$a),t),this.fetch=$s(s)}listBuckets(){return ne(this,void 0,void 0,function*(){try{return{data:yield ze(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(O(e))return{data:null,error:e};throw e}})}getBucket(e){return ne(this,void 0,void 0,function*(){try{return{data:yield ze(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(O(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return ne(this,void 0,void 0,function*(){try{return{data:yield G(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(O(s))return{data:null,error:s};throw s}})}updateBucket(e,t){return ne(this,void 0,void 0,function*(){try{return{data:yield Pa(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(O(s))return{data:null,error:s};throw s}})}emptyBucket(e){return ne(this,void 0,void 0,function*(){try{return{data:yield G(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(O(t))return{data:null,error:t};throw t}})}deleteBucket(e){return ne(this,void 0,void 0,function*(){try{return{data:yield Cs(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(O(t))return{data:null,error:t};throw t}})}}class xa extends Ca{constructor(e,t={},s){super(e,t,s)}from(e){return new ja(this.url,this.headers,e,this.fetch)}}const Ia="2.48.1";let ke="";typeof Deno<"u"?ke="deno":typeof document<"u"?ke="web":typeof navigator<"u"&&navigator.product==="ReactNative"?ke="react-native":ke="node";const La={"X-Client-Info":`supabase-js-${ke}/${Ia}`},Da={headers:La},Ua={schema:"public"},Ba={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Ma={};var Na=function(n,e,t,s){function r(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(u){try{l(s.next(u))}catch(d){a(d)}}function c(u){try{l(s.throw(u))}catch(d){a(d)}}function l(u){u.done?i(u.value):r(u.value).then(o,c)}l((s=s.apply(n,e||[])).next())})};const Fa=n=>{let e;return n?e=n:typeof fetch>"u"?e=vs:e=fetch,(...t)=>e(...t)},qa=()=>typeof Headers>"u"?ks:Headers,za=(n,e,t)=>{const s=Fa(t),r=qa();return(i,a)=>Na(void 0,void 0,void 0,function*(){var o;const c=(o=yield e())!==null&&o!==void 0?o:n;let l=new r(a?.headers);return l.has("apikey")||l.set("apikey",n),l.has("Authorization")||l.set("Authorization",`Bearer ${c}`),s(i,Object.assign(Object.assign({},a),{headers:l}))})};var Va=function(n,e,t,s){function r(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(u){try{l(s.next(u))}catch(d){a(d)}}function c(u){try{l(s.throw(u))}catch(d){a(d)}}function l(u){u.done?i(u.value):r(u.value).then(o,c)}l((s=s.apply(n,e||[])).next())})};function Ja(n){return n.replace(/\/$/,"")}function Ha(n,e){const{db:t,auth:s,realtime:r,global:i}=n,{db:a,auth:o,realtime:c,global:l}=e,u={db:Object.assign(Object.assign({},a),t),auth:Object.assign(Object.assign({},o),s),realtime:Object.assign(Object.assign({},c),r),global:Object.assign(Object.assign({},l),i),accessToken:()=>Va(this,void 0,void 0,function*(){return""})};return n.accessToken?u.accessToken=n.accessToken:delete u.accessToken,u}const xs="2.67.3",Wa="http://localhost:9999",Ga="supabase.auth.token",Ka={"X-Client-Info":`gotrue-js/${xs}`},Ut=10,it="X-Supabase-Api-Version",Is={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}};function Qa(n){return Math.round(Date.now()/1e3)+n}function Ya(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){const e=Math.random()*16|0;return(n=="x"?e:e&3|8).toString(16)})}const M=()=>typeof window<"u"&&typeof document<"u",Q={tested:!1,writable:!1},Ee=()=>{if(!M())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Q.tested)return Q.writable;const n=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(n,n),globalThis.localStorage.removeItem(n),Q.tested=!0,Q.writable=!0}catch{Q.tested=!0,Q.writable=!1}return Q.writable};function Xa(n){const e={},t=new URL(n);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((r,i)=>{e[i]=r})}catch{}return t.searchParams.forEach((s,r)=>{e[r]=s}),e}const Ls=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>E(async()=>{const{default:s}=await Promise.resolve().then(()=>de);return{default:s}},void 0).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)},Za=n=>typeof n=="object"&&n!==null&&"status"in n&&"ok"in n&&"json"in n&&typeof n.json=="function",Ds=async(n,e,t)=>{await n.setItem(e,JSON.stringify(t))},Ce=async(n,e)=>{const t=await n.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},xe=async(n,e)=>{await n.removeItem(e)};function eo(n){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let t="",s,r,i,a,o,c,l,u=0;for(n=n.replace("-","+").replace("_","/");u<n.length;)a=e.indexOf(n.charAt(u++)),o=e.indexOf(n.charAt(u++)),c=e.indexOf(n.charAt(u++)),l=e.indexOf(n.charAt(u++)),s=a<<2|o>>4,r=(o&15)<<4|c>>2,i=(c&3)<<6|l,t=t+String.fromCharCode(s),c!=64&&r!=0&&(t=t+String.fromCharCode(r)),l!=64&&i!=0&&(t=t+String.fromCharCode(i));return t}class Je{constructor(){this.promise=new Je.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}Je.promiseConstructor=Promise;function Bt(n){const e=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i,t=n.split(".");if(t.length!==3)throw new Error("JWT is not valid: not a JWT structure");if(!e.test(t[1]))throw new Error("JWT is not valid: payload is not in base64url format");const s=t[1];return JSON.parse(eo(s))}async function to(n){return await new Promise(e=>{setTimeout(()=>e(null),n)})}function so(n,e){return new Promise((s,r)=>{(async()=>{for(let i=0;i<1/0;i++)try{const a=await n(i);if(!e(i,null,a)){s(a);return}}catch(a){if(!e(i,a)){r(a);return}}})()})}function no(n){return("0"+n.toString(16)).substr(-2)}function ro(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",s=t.length;let r="";for(let i=0;i<56;i++)r+=t.charAt(Math.floor(Math.random()*s));return r}return crypto.getRandomValues(e),Array.from(e,no).join("")}async function io(n){const t=new TextEncoder().encode(n),s=await crypto.subtle.digest("SHA-256",t),r=new Uint8Array(s);return Array.from(r).map(i=>String.fromCharCode(i)).join("")}function ao(n){return btoa(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function oo(n){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),n;const t=await io(n);return ao(t)}async function re(n,e,t=!1){const s=ro();let r=s;t&&(r+="/PASSWORD_RECOVERY"),await Ds(n,`${e}-code-verifier`,r);const i=await oo(s);return[i,s===i?"plain":"s256"]}const co=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function lo(n){const e=n.headers.get(it);if(!e||!e.match(co))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}class pt extends Error{constructor(e,t,s){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=s}}function b(n){return typeof n=="object"&&n!==null&&"__isAuthError"in n}class uo extends pt{constructor(e,t,s){super(e,t,s),this.name="AuthApiError",this.status=t,this.code=s}}function ho(n){return b(n)&&n.name==="AuthApiError"}class Us extends pt{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class ee extends pt{constructor(e,t,s,r){super(e,s,r),this.name=t,this.status=s}}class H extends ee{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function fo(n){return b(n)&&n.name==="AuthSessionMissingError"}class Xe extends ee{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Ie extends ee{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Le extends ee{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function po(n){return b(n)&&n.name==="AuthImplicitGrantRedirectError"}class Mt extends ee{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class at extends ee{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function Ze(n){return b(n)&&n.name==="AuthRetryableFetchError"}class Nt extends ee{constructor(e,t,s){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=s}}var go=function(n,e){var t={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&e.indexOf(s)<0&&(t[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,s=Object.getOwnPropertySymbols(n);r<s.length;r++)e.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(n,s[r])&&(t[s[r]]=n[s[r]]);return t};const Y=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),_o=[502,503,504];async function Ft(n){var e;if(!Za(n))throw new at(Y(n),0);if(_o.includes(n.status))throw new at(Y(n),n.status);let t;try{t=await n.json()}catch(i){throw new Us(Y(i),i)}let s;const r=lo(n);if(r&&r.getTime()>=Is["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?s=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(s=t.error_code),s){if(s==="weak_password")throw new Nt(Y(t),n.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(s==="session_not_found")throw new H}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((i,a)=>i&&typeof a=="string",!0))throw new Nt(Y(t),n.status,t.weak_password.reasons);throw new uo(Y(t),n.status||500,s)}const mo=(n,e,t,s)=>{const r={method:n,headers:e?.headers||{}};return n==="GET"?r:(r.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),r.body=JSON.stringify(s),Object.assign(Object.assign({},r),t))};async function v(n,e,t,s){var r;const i=Object.assign({},s?.headers);i[it]||(i[it]=Is["2024-01-01"].name),s?.jwt&&(i.Authorization=`Bearer ${s.jwt}`);const a=(r=s?.query)!==null&&r!==void 0?r:{};s?.redirectTo&&(a.redirect_to=s.redirectTo);const o=Object.keys(a).length?"?"+new URLSearchParams(a).toString():"",c=await wo(n,e,t+o,{headers:i,noResolveJson:s?.noResolveJson},{},s?.body);return s?.xform?s?.xform(c):{data:Object.assign({},c),error:null}}async function wo(n,e,t,s,r,i){const a=mo(e,s,r,i);let o;try{o=await n(t,Object.assign({},a))}catch(c){throw console.error(c),new at(Y(c),0)}if(o.ok||await Ft(o),s?.noResolveJson)return o;try{return await o.json()}catch(c){await Ft(c)}}function W(n){var e;let t=null;ko(n)&&(t=Object.assign({},n),n.expires_at||(t.expires_at=Qa(n.expires_in)));const s=(e=n.user)!==null&&e!==void 0?e:n;return{data:{session:t,user:s},error:null}}function qt(n){const e=W(n);return!e.error&&n.weak_password&&typeof n.weak_password=="object"&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.message&&typeof n.weak_password.message=="string"&&n.weak_password.reasons.reduce((t,s)=>t&&typeof s=="string",!0)&&(e.data.weak_password=n.weak_password),e}function K(n){var e;return{data:{user:(e=n.user)!==null&&e!==void 0?e:n},error:null}}function yo(n){return{data:n,error:null}}function bo(n){const{action_link:e,email_otp:t,hashed_token:s,redirect_to:r,verification_type:i}=n,a=go(n,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),o={action_link:e,email_otp:t,hashed_token:s,redirect_to:r,verification_type:i},c=Object.assign({},a);return{data:{properties:o,user:c},error:null}}function vo(n){return n}function ko(n){return n.access_token&&n.refresh_token&&n.expires_in}var So=function(n,e){var t={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&e.indexOf(s)<0&&(t[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,s=Object.getOwnPropertySymbols(n);r<s.length;r++)e.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(n,s[r])&&(t[s[r]]=n[s[r]]);return t};class Eo{constructor({url:e="",headers:t={},fetch:s}){this.url=e,this.headers=t,this.fetch=Ls(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t="global"){try{return await v(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(s){if(b(s))return{data:null,error:s};throw s}}async inviteUserByEmail(e,t={}){try{return await v(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:K})}catch(s){if(b(s))return{data:{user:null},error:s};throw s}}async generateLink(e){try{const{options:t}=e,s=So(e,["options"]),r=Object.assign(Object.assign({},s),t);return"newEmail"in s&&(r.new_email=s?.newEmail,delete r.newEmail),await v(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:r,headers:this.headers,xform:bo,redirectTo:t?.redirectTo})}catch(t){if(b(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await v(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:K})}catch(t){if(b(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,s,r,i,a,o,c;try{const l={nextPage:null,lastPage:0,total:0},u=await v(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(t=e?.page)===null||t===void 0?void 0:t.toString())!==null&&s!==void 0?s:"",per_page:(i=(r=e?.perPage)===null||r===void 0?void 0:r.toString())!==null&&i!==void 0?i:""},xform:vo});if(u.error)throw u.error;const d=await u.json(),h=(a=u.headers.get("x-total-count"))!==null&&a!==void 0?a:0,f=(c=(o=u.headers.get("link"))===null||o===void 0?void 0:o.split(","))!==null&&c!==void 0?c:[];return f.length>0&&(f.forEach(p=>{const _=parseInt(p.split(";")[0].split("=")[1].substring(0,1)),g=JSON.parse(p.split(";")[1].split("=")[1]);l[`${g}Page`]=_}),l.total=parseInt(h)),{data:Object.assign(Object.assign({},d),l),error:null}}catch(l){if(b(l))return{data:{users:[]},error:l};throw l}}async getUserById(e){try{return await v(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:K})}catch(t){if(b(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){try{return await v(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:K})}catch(s){if(b(s))return{data:{user:null},error:s};throw s}}async deleteUser(e,t=!1){try{return await v(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:K})}catch(s){if(b(s))return{data:{user:null},error:s};throw s}}async _listFactors(e){try{const{data:t,error:s}=await v(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:r=>({data:{factors:r},error:null})});return{data:t,error:s}}catch(t){if(b(t))return{data:null,error:t};throw t}}async _deleteFactor(e){try{return{data:await v(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(b(t))return{data:null,error:t};throw t}}}const To={getItem:n=>Ee()?globalThis.localStorage.getItem(n):null,setItem:(n,e)=>{Ee()&&globalThis.localStorage.setItem(n,e)},removeItem:n=>{Ee()&&globalThis.localStorage.removeItem(n)}};function zt(n={}){return{getItem:e=>n[e]||null,setItem:(e,t)=>{n[e]=t},removeItem:e=>{delete n[e]}}}function Po(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const ie={debug:!!(globalThis&&Ee()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Bs extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class Ao extends Bs{}async function Oo(n,e,t){ie.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",n,e);const s=new globalThis.AbortController;return e>0&&setTimeout(()=>{s.abort(),ie.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",n)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(n,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:s.signal},async r=>{if(r){ie.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",n,r.name);try{return await t()}finally{ie.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",n,r.name)}}else{if(e===0)throw ie.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",n),new Ao(`Acquiring an exclusive Navigator LockManager lock "${n}" immediately failed`);if(ie.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}Po();const jo={url:Wa,storageKey:Ga,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Ka,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1},be=30*1e3,Vt=3;async function Jt(n,e,t){return await t()}class Pe{constructor(e){var t,s;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Pe.nextInstanceID,Pe.nextInstanceID+=1,this.instanceID>0&&M()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const r=Object.assign(Object.assign({},jo),e);if(this.logDebugMessages=!!r.debug,typeof r.debug=="function"&&(this.logger=r.debug),this.persistSession=r.persistSession,this.storageKey=r.storageKey,this.autoRefreshToken=r.autoRefreshToken,this.admin=new Eo({url:r.url,headers:r.headers,fetch:r.fetch}),this.url=r.url,this.headers=r.headers,this.fetch=Ls(r.fetch),this.lock=r.lock||Jt,this.detectSessionInUrl=r.detectSessionInUrl,this.flowType=r.flowType,this.hasCustomAuthorizationHeader=r.hasCustomAuthorizationHeader,r.lock?this.lock=r.lock:M()&&(!((t=globalThis?.navigator)===null||t===void 0)&&t.locks)?this.lock=Oo:this.lock=Jt,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?r.storage?this.storage=r.storage:Ee()?this.storage=To:(this.memoryStorage={},this.storage=zt(this.memoryStorage)):(this.memoryStorage={},this.storage=zt(this.memoryStorage)),M()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(i){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",i)}(s=this.broadcastChannel)===null||s===void 0||s.addEventListener("message",async i=>{this._debug("received broadcast notification from other tab or client",i),await this._notifyAllSubscribers(i.data.event,i.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${xs}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=Xa(window.location.href);let s="none";if(this._isImplicitGrantCallback(t)?s="implicit":await this._isPKCECallback(t)&&(s="pkce"),M()&&this.detectSessionInUrl&&s!=="none"){const{data:r,error:i}=await this._getSessionFromURL(t,s);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),po(i)){const c=(e=i.details)===null||e===void 0?void 0:e.code;if(c==="identity_already_exists"||c==="identity_not_found"||c==="single_identity_not_deletable")return{error:i}}return await this._removeSession(),{error:i}}const{session:a,redirectType:o}=r;return this._debug("#_initialize()","detected session in URL",a,"redirect type",o),await this._saveSession(a),setTimeout(async()=>{o==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",a):await this._notifyAllSubscribers("SIGNED_IN",a)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return b(t)?{error:t}:{error:new Us("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,s,r;try{const i=await v(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(s=(t=e?.options)===null||t===void 0?void 0:t.data)!==null&&s!==void 0?s:{},gotrue_meta_security:{captcha_token:(r=e?.options)===null||r===void 0?void 0:r.captchaToken}},xform:W}),{data:a,error:o}=i;if(o||!a)return{data:{user:null,session:null},error:o};const c=a.session,l=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:l,session:c},error:null}}catch(i){if(b(i))return{data:{user:null,session:null},error:i};throw i}}async signUp(e){var t,s,r;try{let i;if("email"in e){const{email:u,password:d,options:h}=e;let f=null,p=null;this.flowType==="pkce"&&([f,p]=await re(this.storage,this.storageKey)),i=await v(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:h?.emailRedirectTo,body:{email:u,password:d,data:(t=h?.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:h?.captchaToken},code_challenge:f,code_challenge_method:p},xform:W})}else if("phone"in e){const{phone:u,password:d,options:h}=e;i=await v(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:d,data:(s=h?.data)!==null&&s!==void 0?s:{},channel:(r=h?.channel)!==null&&r!==void 0?r:"sms",gotrue_meta_security:{captcha_token:h?.captchaToken}},xform:W})}else throw new Ie("You must provide either an email or phone number and a password");const{data:a,error:o}=i;if(o||!a)return{data:{user:null,session:null},error:o};const c=a.session,l=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:l,session:c},error:null}}catch(i){if(b(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithPassword(e){try{let t;if("email"in e){const{email:i,password:a,options:o}=e;t=await v(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:a,gotrue_meta_security:{captcha_token:o?.captchaToken}},xform:qt})}else if("phone"in e){const{phone:i,password:a,options:o}=e;t=await v(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:a,gotrue_meta_security:{captcha_token:o?.captchaToken}},xform:qt})}else throw new Ie("You must provide either an email or phone number and a password");const{data:s,error:r}=t;return r?{data:{user:null,session:null},error:r}:!s||!s.session||!s.user?{data:{user:null,session:null},error:new Xe}:(s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:r})}catch(t){if(b(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,s,r,i;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(s=e.options)===null||s===void 0?void 0:s.scopes,queryParams:(r=e.options)===null||r===void 0?void 0:r.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async _exchangeCodeForSession(e){const t=await Ce(this.storage,`${this.storageKey}-code-verifier`),[s,r]=(t??"").split("/");try{const{data:i,error:a}=await v(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:s},xform:W});if(await xe(this.storage,`${this.storageKey}-code-verifier`),a)throw a;return!i||!i.session||!i.user?{data:{user:null,session:null,redirectType:null},error:new Xe}:(i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),{data:Object.assign(Object.assign({},i),{redirectType:r??null}),error:a})}catch(i){if(b(i))return{data:{user:null,session:null,redirectType:null},error:i};throw i}}async signInWithIdToken(e){try{const{options:t,provider:s,token:r,access_token:i,nonce:a}=e,o=await v(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:r,access_token:i,nonce:a,gotrue_meta_security:{captcha_token:t?.captchaToken}},xform:W}),{data:c,error:l}=o;return l?{data:{user:null,session:null},error:l}:!c||!c.session||!c.user?{data:{user:null,session:null},error:new Xe}:(c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),{data:c,error:l})}catch(t){if(b(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,s,r,i,a;try{if("email"in e){const{email:o,options:c}=e;let l=null,u=null;this.flowType==="pkce"&&([l,u]=await re(this.storage,this.storageKey));const{error:d}=await v(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:o,data:(t=c?.data)!==null&&t!==void 0?t:{},create_user:(s=c?.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:c?.captchaToken},code_challenge:l,code_challenge_method:u},redirectTo:c?.emailRedirectTo});return{data:{user:null,session:null},error:d}}if("phone"in e){const{phone:o,options:c}=e,{data:l,error:u}=await v(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:o,data:(r=c?.data)!==null&&r!==void 0?r:{},create_user:(i=c?.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:c?.captchaToken},channel:(a=c?.channel)!==null&&a!==void 0?a:"sms"}});return{data:{user:null,session:null,messageId:l?.message_id},error:u}}throw new Ie("You must provide either an email or phone number.")}catch(o){if(b(o))return{data:{user:null,session:null},error:o};throw o}}async verifyOtp(e){var t,s;try{let r,i;"options"in e&&(r=(t=e.options)===null||t===void 0?void 0:t.redirectTo,i=(s=e.options)===null||s===void 0?void 0:s.captchaToken);const{data:a,error:o}=await v(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:r,xform:W});if(o)throw o;if(!a)throw new Error("An error occurred on token verification.");const c=a.session,l=a.user;return c?.access_token&&(await this._saveSession(c),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",c)),{data:{user:l,session:c},error:null}}catch(r){if(b(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithSSO(e){var t,s,r;try{let i=null,a=null;return this.flowType==="pkce"&&([i,a]=await re(this.storage,this.storageKey)),await v(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&s!==void 0?s:void 0}),!((r=e?.options)===null||r===void 0)&&r.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:i,code_challenge_method:a}),headers:this.headers,xform:yo})}catch(i){if(b(i))return{data:null,error:i};throw i}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:s}=e;if(s)throw s;if(!t)throw new H;const{error:r}=await v(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:r}})}catch(e){if(b(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:s,type:r,options:i}=e,{error:a}=await v(this.fetch,"POST",t,{headers:this.headers,body:{email:s,type:r,gotrue_meta_security:{captcha_token:i?.captchaToken}},redirectTo:i?.emailRedirectTo});return{data:{user:null,session:null},error:a}}else if("phone"in e){const{phone:s,type:r,options:i}=e,{data:a,error:o}=await v(this.fetch,"POST",t,{headers:this.headers,body:{phone:s,type:r,gotrue_meta_security:{captcha_token:i?.captchaToken}}});return{data:{user:null,session:null,messageId:a?.message_id},error:o}}throw new Ie("You must provide either an email or phone number and a type")}catch(t){if(b(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const s=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),r=(async()=>(await s,await t()))();return this.pendingInLock.push((async()=>{try{await r}catch{}})()),r}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const s=t();for(this.pendingInLock.push((async()=>{try{await s}catch{}})()),await s;this.pendingInLock.length;){const r=[...this.pendingInLock];await Promise.all(r),this.pendingInLock.splice(0,r.length)}return await s}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await Ce(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const s=e.expires_at?e.expires_at<=Date.now()/1e3:!1;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",e.expires_at),!s){if(this.storage.isServer){let a=this.suppressGetSessionWarning;e=new Proxy(e,{get:(c,l,u)=>(!a&&l==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),a=!0,this.suppressGetSessionWarning=!0),Reflect.get(c,l,u))})}return{data:{session:e},error:null}}const{session:r,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{session:null},error:i}:{data:{session:r},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await v(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:K}):await this._useSession(async t=>{var s,r,i;const{data:a,error:o}=t;if(o)throw o;return!(!((s=a.session)===null||s===void 0)&&s.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new H}:await v(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(r=a.session)===null||r===void 0?void 0:r.access_token)!==null&&i!==void 0?i:void 0,xform:K})})}catch(t){if(b(t))return fo(t)&&(await this._removeSession(),await xe(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async s=>{const{data:r,error:i}=s;if(i)throw i;if(!r.session)throw new H;const a=r.session;let o=null,c=null;this.flowType==="pkce"&&e.email!=null&&([o,c]=await re(this.storage,this.storageKey));const{data:l,error:u}=await v(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:o,code_challenge_method:c}),jwt:a.access_token,xform:K});if(u)throw u;return a.user=l.user,await this._saveSession(a),await this._notifyAllSubscribers("USER_UPDATED",a),{data:{user:a.user},error:null}})}catch(s){if(b(s))return{data:{user:null},error:s};throw s}}_decodeJWT(e){return Bt(e)}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new H;const t=Date.now()/1e3;let s=t,r=!0,i=null;const a=Bt(e.access_token);if(a.exp&&(s=a.exp,r=s<=t),r){const{session:o,error:c}=await this._callRefreshToken(e.refresh_token);if(c)return{data:{user:null,session:null},error:c};if(!o)return{data:{user:null,session:null},error:null};i=o}else{const{data:o,error:c}=await this._getUser(e.access_token);if(c)throw c;i={access_token:e.access_token,refresh_token:e.refresh_token,user:o.user,token_type:"bearer",expires_in:s-t,expires_at:s},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(t){if(b(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var s;if(!e){const{data:a,error:o}=t;if(o)throw o;e=(s=a.session)!==null&&s!==void 0?s:void 0}if(!e?.refresh_token)throw new H;const{session:r,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{user:null,session:null},error:i}:r?{data:{user:r.user,session:r},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(b(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!M())throw new Le("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Le(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new Mt("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Le("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Mt("No code detected.");const{data:m,error:S}=await this._exchangeCodeForSession(e.code);if(S)throw S;const k=new URL(window.location.href);return k.searchParams.delete("code"),window.history.replaceState(window.history.state,"",k.toString()),{data:{session:m.session,redirectType:null},error:null}}const{provider_token:s,provider_refresh_token:r,access_token:i,refresh_token:a,expires_in:o,expires_at:c,token_type:l}=e;if(!i||!o||!a||!l)throw new Le("No session defined in URL");const u=Math.round(Date.now()/1e3),d=parseInt(o);let h=u+d;c&&(h=parseInt(c));const f=h-u;f*1e3<=be&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${f}s, should have been closer to ${d}s`);const p=h-d;u-p>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",p,h,u):u-p<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",p,h,u);const{data:_,error:g}=await this._getUser(i);if(g)throw g;const y={provider_token:s,provider_refresh_token:r,access_token:i,expires_in:d,expires_at:h,refresh_token:a,token_type:l,user:_.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:y,redirectType:e.type},error:null}}catch(s){if(b(s))return{data:{session:null,redirectType:null},error:s};throw s}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await Ce(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var s;const{data:r,error:i}=t;if(i)return{error:i};const a=(s=r.session)===null||s===void 0?void 0:s.access_token;if(a){const{error:o}=await this.admin.signOut(a,e);if(o&&!(ho(o)&&(o.status===404||o.status===401||o.status===403)))return{error:o}}return e!=="others"&&(await this._removeSession(),await xe(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=Ya(),s={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,s),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:s}}}async _emitInitialSession(e){return await this._useSession(async t=>{var s,r;try{const{data:{session:i},error:a}=t;if(a)throw a;await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(i){await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}})}async resetPasswordForEmail(e,t={}){let s=null,r=null;this.flowType==="pkce"&&([s,r]=await re(this.storage,this.storageKey,!0));try{return await v(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:s,code_challenge_method:r,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(i){if(b(i))return{data:null,error:i};throw i}}async getUserIdentities(){var e;try{const{data:t,error:s}=await this.getUser();if(s)throw s;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(b(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:s,error:r}=await this._useSession(async i=>{var a,o,c,l,u;const{data:d,error:h}=i;if(h)throw h;const f=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(a=e.options)===null||a===void 0?void 0:a.redirectTo,scopes:(o=e.options)===null||o===void 0?void 0:o.scopes,queryParams:(c=e.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:!0});return await v(this.fetch,"GET",f,{headers:this.headers,jwt:(u=(l=d.session)===null||l===void 0?void 0:l.access_token)!==null&&u!==void 0?u:void 0})});if(r)throw r;return M()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(s?.url),{data:{provider:e.provider,url:s?.url},error:null}}catch(s){if(b(s))return{data:{provider:e.provider,url:null},error:s};throw s}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var s,r;const{data:i,error:a}=t;if(a)throw a;return await v(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(r=(s=i.session)===null||s===void 0?void 0:s.access_token)!==null&&r!==void 0?r:void 0})})}catch(t){if(b(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const s=Date.now();return await so(async r=>(r>0&&await to(200*Math.pow(2,r-1)),this._debug(t,"refreshing attempt",r),await v(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:W})),(r,i)=>{const a=200*Math.pow(2,r);return i&&Ze(i)&&Date.now()+a-s<be})}catch(s){if(this._debug(t,"error",s),b(s))return{data:{session:null,user:null},error:s};throw s}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const s=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",s),M()&&!t.skipBrowserRedirect&&window.location.assign(s),{data:{provider:e,url:s},error:null}}async _recoverAndRefresh(){var e;const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const s=await Ce(this.storage,this.storageKey);if(this._debug(t,"session from storage",s),!this._isValidSession(s)){this._debug(t,"session is not valid"),s!==null&&await this._removeSession();return}const r=Math.round(Date.now()/1e3),i=((e=s.expires_at)!==null&&e!==void 0?e:1/0)<r+Ut;if(this._debug(t,`session has${i?"":" not"} expired with margin of ${Ut}s`),i){if(this.autoRefreshToken&&s.refresh_token){const{error:a}=await this._callRefreshToken(s.refresh_token);a&&(console.error(a),Ze(a)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",a),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(s){this._debug(t,"error",s),console.error(s);return}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,s;if(!e)throw new H;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const r=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(r,"begin");try{this.refreshingDeferred=new Je;const{data:i,error:a}=await this._refreshAccessToken(e);if(a)throw a;if(!i.session)throw new H;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const o={session:i.session,error:null};return this.refreshingDeferred.resolve(o),o}catch(i){if(this._debug(r,"error",i),b(i)){const a={session:null,error:i};return Ze(i)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(a),a}throw(s=this.refreshingDeferred)===null||s===void 0||s.reject(i),i}finally{this.refreshingDeferred=null,this._debug(r,"end")}}async _notifyAllSubscribers(e,t,s=!0){const r=`#_notifyAllSubscribers(${e})`;this._debug(r,"begin",t,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:e,session:t});const i=[],a=Array.from(this.stateChangeEmitters.values()).map(async o=>{try{await o.callback(e,t)}catch(c){i.push(c)}});if(await Promise.all(a),i.length>0){for(let o=0;o<i.length;o+=1)console.error(i[o]);throw i[0]}}finally{this._debug(r,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await Ds(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await xe(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&M()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),be);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:s}}=t;if(!s||!s.refresh_token||!s.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const r=Math.floor((s.expires_at*1e3-e)/be);this._debug("#_autoRefreshTokenTick()",`access token expires in ${r} ticks, a tick lasts ${be}ms, refresh threshold is ${Vt} ticks`),r<=Vt&&await this._callRefreshToken(s.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof Bs)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!M()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,s){const r=[`provider=${encodeURIComponent(t)}`];if(s?.redirectTo&&r.push(`redirect_to=${encodeURIComponent(s.redirectTo)}`),s?.scopes&&r.push(`scopes=${encodeURIComponent(s.scopes)}`),this.flowType==="pkce"){const[i,a]=await re(this.storage,this.storageKey),o=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(a)}`});r.push(o.toString())}if(s?.queryParams){const i=new URLSearchParams(s.queryParams);r.push(i.toString())}return s?.skipBrowserRedirect&&r.push(`skip_http_redirect=${s.skipBrowserRedirect}`),`${e}?${r.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var s;const{data:r,error:i}=t;return i?{data:null,error:i}:await v(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(s=r?.session)===null||s===void 0?void 0:s.access_token})})}catch(t){if(b(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var s,r;const{data:i,error:a}=t;if(a)return{data:null,error:a};const o=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:c,error:l}=await v(this.fetch,"POST",`${this.url}/factors`,{body:o,headers:this.headers,jwt:(s=i?.session)===null||s===void 0?void 0:s.access_token});return l?{data:null,error:l}:(e.factorType==="totp"&&(!((r=c?.totp)===null||r===void 0)&&r.qr_code)&&(c.totp.qr_code=`data:image/svg+xml;utf-8,${c.totp.qr_code}`),{data:c,error:null})})}catch(t){if(b(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:r,error:i}=t;if(i)return{data:null,error:i};const{data:a,error:o}=await v(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(s=r?.session)===null||s===void 0?void 0:s.access_token});return o?{data:null,error:o}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),{data:a,error:o})})}catch(t){if(b(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:r,error:i}=t;return i?{data:null,error:i}:await v(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(s=r?.session)===null||s===void 0?void 0:s.access_token})})}catch(t){if(b(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:s}=await this._challenge({factorId:e.factorId});return s?{data:null,error:s}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const s=e?.factors||[],r=s.filter(a=>a.factor_type==="totp"&&a.status==="verified"),i=s.filter(a=>a.factor_type==="phone"&&a.status==="verified");return{data:{all:s,totp:r,phone:i},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,s;const{data:{session:r},error:i}=e;if(i)return{data:null,error:i};if(!r)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const a=this._decodeJWT(r.access_token);let o=null;a.aal&&(o=a.aal);let c=o;((s=(t=r.user.factors)===null||t===void 0?void 0:t.filter(d=>d.status==="verified"))!==null&&s!==void 0?s:[]).length>0&&(c="aal2");const u=a.amr||[];return{data:{currentLevel:o,nextLevel:c,currentAuthenticationMethods:u},error:null}}))}}Pe.nextInstanceID=0;const Ro=Pe;class $o extends Ro{constructor(e){super(e)}}var Co=function(n,e,t,s){function r(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(u){try{l(s.next(u))}catch(d){a(d)}}function c(u){try{l(s.throw(u))}catch(d){a(d)}}function l(u){u.done?i(u.value):r(u.value).then(o,c)}l((s=s.apply(n,e||[])).next())})};class xo{constructor(e,t,s){var r,i,a;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const o=Ja(e);this.realtimeUrl=`${o}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${o}/auth/v1`,this.storageUrl=`${o}/storage/v1`,this.functionsUrl=`${o}/functions/v1`;const c=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,l={db:Ua,realtime:Ma,auth:Object.assign(Object.assign({},Ba),{storageKey:c}),global:Da},u=Ha(s??{},l);this.storageKey=(r=u.auth.storageKey)!==null&&r!==void 0?r:"",this.headers=(i=u.global.headers)!==null&&i!==void 0?i:{},u.accessToken?(this.accessToken=u.accessToken,this.auth=new Proxy({},{get:(d,h)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(h)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((a=u.auth)!==null&&a!==void 0?a:{},this.headers,u.global.fetch),this.fetch=za(t,this._getAccessToken.bind(this),u.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},u.realtime)),this.rest=new ra(`${o}/rest/v1`,{headers:this.headers,schema:u.db.schema,fetch:this.fetch}),u.accessToken||this._listenForAuthEvents()}get functions(){return new Hi(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new xa(this.storageUrl,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},s={}){return this.rest.rpc(e,t,s)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return Co(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:s}=yield this.auth.getSession();return(t=(e=s.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:r,storageKey:i,flowType:a,lock:o,debug:c},l,u){const d={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new $o({url:this.authUrl,headers:Object.assign(Object.assign({},d),l),storageKey:i,autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:r,flowType:a,lock:o,debug:c,fetch:u,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new ya(this.realtimeUrl,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,s)=>{this._handleTokenChanged(t,"CLIENT",s?.access_token)})}_handleTokenChanged(e,t,s){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==s?this.changedAccessToken=s:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const Io=(n,e,t)=>new xo(n,e,t),Lo="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let Do=(n=21)=>{let e="",t=crypto.getRandomValues(new Uint8Array(n|=0));for(;n--;)e+=Lo[t[n]&63];return e};async function Uo(n,e){await Ni("plugin:clipboard-manager|write_text",{label:e?.label,text:n})}let Bo=cs([]);const Ve=20,Ms={public:"latest",featured:"featured",user:"user"},Ns=(n,e=void 0)=>{const t=typeof sessionStorage<"u"?sessionStorage:{},s=cs(typeof t[n]<"u"?t[n]:e);return s.listen(r=>{typeof r>"u"?delete t[n]:t[n]=r}),s};let gt=Ns("viewingPatternData",{id:"",code:"",collection:Ms.user,created_at:Date.now()});const Ht=()=>wt(gt.get()),fc=()=>ct(gt),pc=n=>{gt.set(JSON.stringify(n))};function Fs(n){return isNaN(n)?0:n}function gc(n){n=Fs(n);const e=n*Ve;return mt.from("code_v1").select().eq("public",!0).range(e,e+Ve).order("id",{ascending:!1})}function _c(n=0){n=Fs(n);const e=n*Ve;return mt.from("code_v1").select().eq("featured",!0).range(e,e+Ve).order("id",{ascending:!1})}const _t=Ns("activePattern","");function Wt(n){_t.set(n)}function Mo(){return _t.get()}function mc(){return ct(_t)}const wc=n=>N.setKey("latestCode",n),Gt="",ot={collection:Ms.user,getAll(){return wt(N.get().userPatterns)??{}},getPatternData(n){return this.getAll()[n]},exists(n){return this.getPatternData(n)!=null},isValidID(n){return n!=null&&n.length>0},create(){const n=No(),t={code:Gt,created_at:Date.now(),id:n,collection:this.collection};return{id:n,data:t}},createAndAddToDB(){const n=this.create();return this.update(n.id,n.data)},update(n,e){const t=this.getAll();return e={...e,id:n,collection:this.collection},Me({...t,[n]:e}),{id:n,data:e}},duplicate(n){const e=this.create();return this.update(e.id,{...e.data,code:n.code})},clearAll(){qo("This will delete all your patterns. Are you really sure?").then(n=>{if(n==!1)return;const e=Ht();return Me({}),e.collection!==this.collection?{id:e.id,data:e}:(Wt(null),this.create())})},delete(n){const e=this.getAll();delete e[n],Mo()===n&&Wt(null),Me(e);const s=Ht()?.id;return s===n?{id:null,data:{code:Gt}}:{id:s,data:e[s]}}};function Me(n){return N.setKey("userPatterns",JSON.stringify(n))}const No=()=>Do(12);async function yc(n){const e=Array.from(n);await Promise.all(e.map(async(t,s)=>{const r=await t.text();if(t.type==="application/json"){const i=ot.getAll();Me({...i,...wt(r)})}else if(["text/x-markdown","text/plain"].includes(t.type)){const i=t.name.replace(/\.[^/.]+$/,"");ot.update(i,{code:r})}})),U("import done!")}async function bc(){const n=ot.getAll(),e=new Blob([JSON.stringify(n)],{type:"application/json"}),t=document.createElement("a");t.href=window.URL.createObjectURL(e);const s=new Date().toISOString().split("T")[0];t.download=`strudel_patterns_${s}.json`,document.body.appendChild(t),t.click(),document.body.removeChild(t)}const mt=Io("https://pidxdsxphlhzjnzmifth.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBpZHhkc3hwaGxoempuem1pZnRoIiwicm9sZSI6ImFub24iLCJpYXQiOjE2NTYyMzA1NTYsImV4cCI6MTk3MTgwNjU1Nn0.bqlw7802fsWRnqU5BLYtmXk_k-D1VFmbkHMywWc15NM");let Fo;async function vc(){try{const e=window.location.href.split("?")[1]?.split("#")?.[0]?.split("&")[0],t=window.location.href.split("#")[1]||"";if(t)return Zr(t);if(e)return mt.from("code_v1").select("code").eq("hash",e).then(({data:s,error:r})=>{if(r&&console.warn("failed to load hash",r),s.length)return s[0].code})}catch(n){console.warn("failed to decode",n)}}const wt=n=>{n=n!=null&&n.length?n:"{}";try{return JSON.parse(n)}catch{return"{}"}};async function kc(){await Fo;const n=Object.entries(Bo.get()),e=r=>r[Math.floor(Math.random()*r.length)],[t,s]=e(n);return s}function Sc(){let n=[E(()=>import("./index.D1tCthlq.js").then(e=>e.K),[]),E(()=>import("./index.hZxiVsR6.js"),__vite__mapDeps([6,3,1])),E(()=>import("./index.CqHAoRZ_.js"),__vite__mapDeps([7,8,3,1,5])),E(()=>Promise.resolve().then(()=>si),void 0),E(()=>import("./index.BB2Lnacl.js"),__vite__mapDeps([9,1])),E(()=>Promise.resolve().then(()=>ci),void 0),E(()=>Promise.resolve().then(()=>li),void 0),E(()=>import("./hydra.gpAyA9If.js"),__vite__mapDeps([10,3,1])),E(()=>import("./serial.CFhbqbTc.js"),__vite__mapDeps([11,1])),E(()=>import("./index.VCcaijur.js"),__vite__mapDeps([0,1,2,3])),E(()=>import("./index.B1eFgcIO.js"),__vite__mapDeps([12,13,1,2,3])),E(()=>import("./tidal.DeIgCVsn.js"),__vite__mapDeps([14,1,8,3,5])),E(()=>import("./index.DTgqVnXz.js"),__vite__mapDeps([15,1])),E(()=>import("./index.C9AzqDct.js"),__vite__mapDeps([16,1])),E(()=>import("./mqtt.lCJglmVd.js"),__vite__mapDeps([17,1,5])),E(()=>import("./mondough.BrbK85b5.js"),__vite__mapDeps([18,1,8,3,5]))];return bs()?n=n.concat([E(()=>import("./loggerbridge.B2zeuyNh.js"),__vite__mapDeps([19,1,8,3,5,2,13,20])),E(()=>import("./midibridge.Kbn8ImPn.js"),__vite__mapDeps([21,22,1,8,3,5,2,13,20])),E(()=>import("./oscbridge.CiWy4BsD.js"),__vite__mapDeps([23,1,24,22,8,3,5,2,13,20]))]):n=n.concat([E(()=>import("./index.C4_94hhA.js"),__vite__mapDeps([25,1])),E(()=>import("./osc.BQLdUe1R.js"),__vite__mapDeps([24,1]))]),Xr(Ui,...n)}function qo(n){const e=confirm(n);return e instanceof Promise?e:new Promise(t=>{t(e)})}async function Ec(){try{const n=window.location.href;bs()?await Uo(n):await navigator.clipboard.writeText(n);const e="Link copied to clipboard!";alert(e),U(e,"highlight")}catch(n){console.error(n)}}const Tc=()=>window.location!==window.parent.location;function zo(){try{return!window.top.location.hostname}catch{return!0}}const Kt=()=>zo()?!1:window.top?.location?.pathname.includes("udels");function Pc(n){try{const e=Mi(n);rs(e.version)}catch(e){console.error("Error parsing metadata.."),console.error(e)}}export{ec as A,vi as B,ki as C,$i as D,Zo as E,nc as F,ic as G,rc as H,ac as I,A as J,wc as K,Ht as L,pc as M,No as N,Wt as O,vc as P,kc as Q,Ec as R,Tc as S,_c as a,Sc as b,Kt as c,mc as d,fc as e,wt as f,Mi as g,ot as h,Ni as i,yc as j,bc as k,gc as l,ct as m,Do as n,Te as o,tc as p,_s as q,di as r,Pc as s,oc as t,sc as u,Xo as v,Ri as w,qo as x,N as y,Ci as z};
